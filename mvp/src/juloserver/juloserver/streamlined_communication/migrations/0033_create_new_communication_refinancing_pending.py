# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2020-04-07 06:11
from __future__ import unicode_literals

from django.db import migrations
from juloserver.streamlined_communication.constant import CommunicationPlatform

from juloserver.julo.constants import VoiceTypeStatus


def add_communications_refinancing_pending(apps, schema_editor):
    StreamlinedMessage = apps.get_model("streamlined_communication", "StreamlinedMessage")
    StreamlinedCommunication = apps.get_model("streamlined_communication", "StreamlinedCommunication")


    # MTL + 4
    message_content = '[{"action": "talk","voiceName": "Damayanti","text": "Selamat {{greet}}, {{name_with_title}}, ' \
                      'Pengajuan refinancing anda telah disetujui. Segera lakukan pembayaran pertama ' \
                      'untuk mengaktifkan skema pembayaran baru anda. Terima kasih"}]'
    robocall_reminder_refinancing_pending, _ = \
        StreamlinedMessage.objects.get_or_create(
            message_content=message_content,
            parameter="{greet,name_with_title}"
        )

    streamlined_communication_for_robocall_reminder_refinancing_pending = StreamlinedCommunication.objects.get_or_create(
        message=robocall_reminder_refinancing_pending,
        status="this Robocall is send on day=4 after status loan refinancing change to Approved",
        communication_platform=CommunicationPlatform.ROBOCALL,
        template_code="nexmo_robocall_mtl_ref_pending_dpd_3",
        type=VoiceTypeStatus.PAYMENT_REMINDER,
        product="nexmo_mtl",
        is_automated=True,
        description="send nexmo robocall mtl payment reminder refinancing pending",
        function_name="{send_voice_payment_reminder,"
                      "retry_send_voice_payment_reminder1,"
                      "retry_send_voice_payment_reminder2}",
        call_hours="{8:00,10:00,12:00}",
        attempts=3
    )

    sms_refinancing_pending_day_2, _ = \
        StreamlinedMessage.objects.get_or_create(
            message_content="Yth {{firstname}}, Anda telah melakukan permohonan refinancing. " \
                             "Konfirmasi dgn melakukan pembayaran pertama. " \
                             "Utk detailnya silahkan cek email Anda kembali. ",
            parameter="{firstname}"
        )
    streamlined_communication_for_loan_refinancing_sms_day_2 = StreamlinedCommunication.objects. \
        get_or_create(
            message=sms_refinancing_pending_day_2,
            product='mtl',
            time_sent='13:00',
            dpd=1,
            communication_platform=CommunicationPlatform.SMS,
            template_code='sms_mtl_ref_pending_dpd_2',
            status="Inform customer loan refinancing day 2",
            description="this SMS called in send_automated_comms",
            is_automated=True,
            )

    sms_refinancing_pending_day_5, _ = \
        StreamlinedMessage.objects.get_or_create(
            message_content="Yth {{firstname}}, hari TERAKHIR utk aktivasi permohonan refinancing Anda. " \
                            "Konfirmasi dgn melakukan pembayaran pertama. " \
                            "Utk detailnya silahkan cek email Anda kembali. ",
            parameter="{firstname}"
        )
    streamlined_communication_for_loan_refinancing_sms_day_5 = StreamlinedCommunication.objects. \
        get_or_create(
            message=sms_refinancing_pending_day_5,
            product='mtl',
            time_sent='13:00',
            dpd=1,
            communication_platform=CommunicationPlatform.SMS,
            template_code='sms_mtl_ref_pending_dpd_5',
            status="Inform customer loan refinancing day 5",
            description="this SMS called in send_automated_comms",
            is_automated=True,
            )


class Migration(migrations.Migration):

    dependencies = [
        ('streamlined_communication', '0032_create_new_robocall_template_dpd_4'),
    ]

    operations = [
        migrations.RunPython(add_communications_refinancing_pending, migrations.RunPython.noop),
    ]
