# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2020-02-16 15:52
from __future__ import unicode_literals
from django.db import migrations
from juloserver.streamlined_communication.constant import CommunicationPlatform


def update_email_streamlined_data(apps, schema_editor):
    StreamlinedCommunication = \
        apps.get_model("streamlined_communication", "StreamlinedCommunication")
    data = [
        {
            'template_code': 'email_reminder_in4',
            'product': 'mtl',
            'title': 'JULO - Bayar Hari Ini, {{today_str}} '
                     'dan Dapatkan Cashback {{total_cashback_amount}}'
        },
        {
            'template_code': 'stl_email_reminder_in4',
            'product': 'stl',
            'title': 'JULO - Reminder Pinjaman Anda'
        },
        {
            'template_code': 'email_reminder_in2',
            'product': 'mtl',
            'title': 'JULO - Bayar Sekarang, {{today_str}} '
                     'dan Dapatkan Cashback {{total_cashback_amount}}'
        },
        {
            'template_code': 'stl_email_reminder_in2',
            'product': 'stl',
            'title': 'JULO - Reminder Pinjaman Anda'
        },
        {
            'template_code': 'email_reminder_in+4',
            'product': 'mtl',
            'title': 'JULO - Pembayaran pinjaman Anda terlambat! '
                     'Hindari biaya keterlambatan.'
        },
    ]
    for item in data:
        StreamlinedCommunication.objects. \
            filter(communication_platform=CommunicationPlatform.EMAIL,
                   template_code=item['template_code']) \
            .update(product=item['product'], type='Payment Reminder',
                    time_sent='12:30', is_automated=True,
                    subject=item['title'])

    StreamlinedCommunication.objects.filter(template_code='email_reminder_ptp_-1-3-5')\
        .update(product='internal_product', type='Payment Reminder', time_sent='12:30',
                is_automated=True,
                subject='Segera Lunasi Janji Bayar Anda Sebelum {{due_date}} '
                        'Untuk Menghindari Proses Hukum Lebih Lanjut')


class Migration(migrations.Migration):
    dependencies = [
        ('streamlined_communication',
         '0039_add_field_subject_to_stream_lined_communication'),
    ]

    operations = [
        migrations.RunPython(update_email_streamlined_data,
                             migrations.RunPython.noop)
    ]
