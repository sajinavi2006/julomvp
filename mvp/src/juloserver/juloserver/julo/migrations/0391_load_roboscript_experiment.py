# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2019-03-20 05:12

from __future__ import unicode_literals
from datetime import datetime, time
from dateutil.relativedelta import relativedelta
from django.db import migrations
from django.utils import timezone
from ..constants import ExperimentConst
from ..statuses import ApplicationStatusCodes


def load_roboscript_experiment_setting(apps, schema_editor):
    ExperimentSetting = apps.get_model("julo", "ExperimentSetting")
    today = timezone.now()
    start_date = today + relativedelta(day=22, hour=0, minute=0)
    end_date = today + relativedelta(day=9, month=4, hour=0, minute=0)
    experiments = [
        {
            "code": ExperimentConst.ROBOCALL_SCRIPT,
            "name": "Robocall Script Experiment",
            "type": "payment",
            "schedule": "07:00",
            "action": None,
            "criteria": {
                "payment_id": "#last:1:0,1,2,3,4",
                "dpd":["-5", "-3"],
                "is_paid": False,
            },
            "start_date": datetime.combine(start_date, time.min),
            "end_date": datetime.combine(end_date, time.max),
            "is_active": True
        },
    ]


    for experiment in experiments:
        experiment_obj = ExperimentSetting(**experiment)
        experiment_obj.save()


class Migration(migrations.Migration):

    dependencies = [
        ('julo', '0390_faq_pre_populate_03'),
    ]

    operations = [
        migrations.RunPython(load_roboscript_experiment_setting, migrations.RunPython.noop)
    ]
