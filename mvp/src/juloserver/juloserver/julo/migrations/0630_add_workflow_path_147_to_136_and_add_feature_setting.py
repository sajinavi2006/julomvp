# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2019-12-30 11:34
from __future__ import unicode_literals

from django.conf import settings
import django.core.validators
from django.db import migrations, models
import django.db.models.deletion
import juloserver.julo.models
from juloserver.julo.constants import FeatureNameConst
from juloserver.julo.management.commands import load_workflow, update_status_lookups, load_status_change_reasons
from juloserver.julo.statuses import ApplicationStatusCodes


class Migration(migrations.Migration):
    def create_new_workflow_path_147_to_136(apps, schema_editor):
        opts = {'workflow_name': ('cash_loan',)}
        load_workflow.Command().handle(**opts)
        update_status_lookups.Command().handle()
        load_status_change_reasons.Command().handle()

    def add_face_recognition_expired_application(apps, schema_editor):
        FeatureSetting = apps.get_model("julo", "FeatureSetting")
        feature_setting = FeatureSetting.objects.get(feature_name=FeatureNameConst.FACE_RECOGNITION)
        feature_setting.feature_name=FeatureNameConst.SLACK_NOTIFICATION_FACE_RECOGNITION
        feature_setting.parameters=['UMFHYCUGH', 'U2M1DBAQ2', 'UKZC8UE2H', 'U5ND8AZBM', 'UFZ7RDCQK']
        feature_setting.description='list of slack users for face recognition notify'
        feature_setting.save()

        FeatureSetting.objects.get_or_create(is_active=True,
                                             feature_name=FeatureNameConst.EXPIRED_147_FACE_RECOGNITION,
                                             parameters={'days': 2, },
                                             description="expired from status 147 to 136"
                                             )


    dependencies = [
        ('julo', '0629_create_new_status_path_147'),
    ]

    operations = [
       migrations.RunPython(create_new_workflow_path_147_to_136),
       migrations.RunPython(add_face_recognition_expired_application),
    ]
