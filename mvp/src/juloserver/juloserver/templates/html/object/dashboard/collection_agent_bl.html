{% extends "common/theme1/layout_theme1.html" %}

{% load checkusergroup from common %}
{% load static from staticfiles %}

{% block meta %}
    <!-- <meta http-equiv="refresh" content="120"> -->
{% endblock %}

{% block custom_css %}
  <!-- morris CSS -->
  <!-- <link href="{% static 'theme/plugins/bower_components/morrisjs/morris.css' %}" rel="stylesheet"> -->
  <!-- toast -->
  <link href="{% static 'theme/plugins/bower_components/toast-master/css/jquery.toast.css' %}" rel="stylesheet">
{% endblock %}

{% block css_inside %}
  .status_font {
    font-size: 24px;
  }
  .analytics-info {
    border: solid 1px;
    border-radius: 3px;
  }
  .panel{
    border: solid 1px;
    border-radius: 3px;
  }
  .btn-statement{
    margin-left: 8.8% !important;
  }
  .container-fluid {
    background-color: white;
  }
  hr{
    margin-top: 0px !important;
    margin-bottom: 10px !important;
  }
   .clearFix
   {
       clear:both;
   }
   .panel.panel-chat
   {
       position: fixed;
       bottom:0;
       right:10px;
       max-width: 800px;
       box-shadow: none;
       -webkit-box-shadow: none;
   }
   .panel.panel-chat.panel-chat-extend
   {
       position: fixed;
       bottom:0;
       right:60em;
       max-width: 800px;
       height:50em;
       box-shadow: none;
       -webkit-box-shadow: none;
   }
   .panel.panel-chat .panel-heading
   {
       background: #4b67a8;
       border: 1px solid #2e4588;
       color:#FFF;
   }
   .panel.panel-chat .panel-heading a:nth-of-type(1)
   {
       text-decoration: none;
       width: 800px;
       color:#FFF;
       font-weight: bold;
       float:left;
   }
   .panel.panel-chat .panel-heading a:nth-of-type(2)
   {
       text-decoration: none;
       max-width: 11px;
       width: 11px;
       color:#FFF;
       float:right;
   }
   .panel.panel-chat .panel-body
   {
       display: block;
       padding: 10px;
       margin: 0;
       max-height: 350px;
       height: 350px;
       border-left: 1px solid #b2b2b2;
       border-right: 1px solid #b2b2b2;
       background: white;
       overflow: auto;
   }
   .panel.panel-chat .panel-body::-webkit-scrollbar {
        display: none;
    }
    .panel.panel-chat .panel-body-extend
    {
        display: block;
        padding: 10px;
        margin: 0;
        max-height: 40em;
        height: 40em;
        border-left: 1px solid #b2b2b2;
        border-right: 1px solid #b2b2b2;
        background: white;
        overflow: auto;
    }
    .panel.panel-chat .panel-body-extend::-webkit-scrollbar {
         display: none;
     }
    .unselectable {
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }
    .custom-button{
      border: 2px solid #4CAF50;
      background-color: white;
      color: green;
      padding: 5px 28px;
      font-size: 16px;
      cursor: pointer;
    }
    .custom-button:hover {
      background-color: #4CAF50;
      color: white;
    }
{% endblock %}


{% block script_head %}
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-19175540-9', 'auto');
    ga('send', 'pageview');

    window.onbeforeunload = function() {
      return "Jangan refresh ketika auto chooser berlangsung, anda yakin?";
    };
  </script>

{% endblock %}


{% block inside_body %}
<!-- Preloader -->
<div class="preloader">
  <div class="cssload-speeding-wheel"></div>
</div>

<!-- Page Content -->
  <div id="wrapper">
    <div id="app" class="container-fluid">
          <div class="btn-statement col-lg-offset-1 col-md-2 col-sm-12 col-xs-12 m-b-10 m-t-10">
            <button class="btn btn-success btn-block" v-bind:style="{'background-color': blBtnColor}" disabled>BL Statements</button>
          </div>
            <div class="col-lg-11 col-sm-11 col-xs-12 col-lg-offset-1">
                <div v-for="blBucket in bl_payment_bucket_list" :key="blBucket.key">
                  {% if role_name == 'collection_agent_partnership_bl_2a' %}
                    {% include "object/dashboard/include/collection_agent_partnership_bl_2a_bucket.html" %}
                  {% elif role_name == 'collection_agent_partnership_bl_2b' %}
                    {% include "object/dashboard/include/collection_agent_partnership_bl_2b_bucket.html" %}
                  {% elif role_name == 'collection_agent_partnership_bl_3a' %}
                    {% include "object/dashboard/include/collection_agent_partnership_bl_3a_bucket.html" %}
                  {% elif role_name == 'collection_agent_partnership_bl_3b' %}
                    {% include "object/dashboard/include/collection_agent_partnership_bl_3b_bucket.html" %}
                  {% elif role_name == 'collection_agent_partnership_bl_4' %}
                    {% include "object/dashboard/include/collection_agent_partnership_bl_4_bucket.html" %}
                  {% elif role_name == 'collection_agent_partnership_bl_5' %}
                    {% include "object/dashboard/include/collection_agent_partnership_bl_5_bucket.html" %}
                  {% endif %}
              </div>
          </div>
    <!-- /.container-fluid -->
  </div>
  <!-- /#page-wrapper -->
  
  
{% endblock %}
{% block custom_link %}
<link href="{% static 'theme/plugins/bower_components/bootstrap-select/bootstrap-select.min.css' %}" rel="stylesheet" />
<link href="{% static 'theme/plugins/bower_components/clockpicker/dist/jquery-clockpicker.min.css' %}" rel="stylesheet">
<link href="{% static 'theme/plugins/bower_components/bootstrap-datepicker/bootstrap-datepicker.min.css' %}" rel="stylesheet" type="text/css" />
<link href="{% static 'theme/plugins/bower_components/timepicker/bootstrap-timepicker.min.css' %}" rel="stylesheet">
<link href="{% static 'theme/plugins/bower_components/bootstrap-daterangepicker/daterangepicker.css' %}" rel="stylesheet">
<link href="{% static 'theme/plugins/bower_components/toast-master/css/jquery.toast.css' %}" rel="stylesheet">
<link href="{% static 'default/css/julo-sorting.css' %}" rel="stylesheet">
<link href="{% static 'theme/plugins/bower_components/footable/css/footable.core.css' %}" rel="stylesheet">
{% endblock %}
{% block script_additional %}
<script src="{% static 'theme/plugins/bower_components/moment/moment.js' %}"></script>
<script src="{% static 'theme/plugins/bower_components/timepicker/bootstrap-timepicker.min.js' %}"></script>
<script src="{% static 'theme/plugins/bower_components/bootstrap-daterangepicker/daterangepicker-julo.js' %}"></script>
<script src="{% static 'theme/plugins/bower_components/bootstrap-select/bootstrap-select.min.js' %}" type="text/javascript"></script>
<script src="{% static 'theme/plugins/bower_components/styleswitcher/jQuery.style.switcher.js' %}"></script>
<script src="{% static 'theme/plugins/bower_components/bootstrap-datepicker/bootstrap-datepicker.min.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
<script src="{% static 'theme/plugins/bower_components/toast-master/js/jquery.toast.js' %}"></script>
<script src="{% static 'default/js/vue.js' %}"></script>
<script src="{% static 'default/js/filter.js' %}"></script>
<script type="text/javascript">
  var app = new Vue({
    el: '#app',
    delimiters: ["<%", "%>"],
    data: {
      blBtnColor: '#D71249 !important',
      statement_dashboard : {},
      role_name:'{{ role_name }}',
      bl_payment_bucket_list: [
          {
            'name': 'T-0',
            'key': 'bl_T0',
            'url': '{% url "bl_statement:list" "collection_agent_bl_duetoday" %}'
          },
          {
            'name': 'T +1 to T +5',
            'key': 'bl_T1toT5',
            'url': '{% url "bl_statement:list" "collection_agent_bl_1to5" %}'
          },
          {
            'name': 'T +6 to T +14',
            'key': 'bl_T6toT14',
            'url': '{% url "bl_statement:list" "collection_agent_bl_6to14" %}'
          },
          {
            'name': 'T +15 to T +29',
            'key': 'bl_T15toT29',
            'url': '{% url "bl_statement:list" "collection_agent_bl_15to29" %}'
          },
          {
            'name': 'T +30 to T +44',
            'key': 'bl_T30toT44',
            'url': '{% url "bl_statement:list" "collection_agent_bl_30to44" %}'
          },
          {
            'name': 'T +45 to T +59',
            'key': 'bl_T45toT59',
            'url': '{% url "bl_statement:list" "collection_agent_bl_45to59" %}'
          },
          {
            'name': 'T +60 to T +89',
            'key': 'bl_T60toT89',
            'url': '{% url "bl_statement:list" "collection_agent_bl_60to89" %}'
          },
          {
            'name': 'T +90+',
            'key': 'bl_T90plus',
            'url': '{% url "bl_statement:list" "collection_agent_bl_90plus" %}'
          }
      ],
    },
    beforeMount(){
      self = this
      this.getBucketCount()
    },
    methods: {
      getBucketCount: function () {
        var self = this
        $.ajax({
            url :  "{%url 'dashboard:get_collection_agent_bl_bucket' %}/", // the endpoint
            type : "GET", // http method
            data : {
              csrfmiddlewaretoken: this.csrftoken
              }, // data sent with the get request

            // handle a successful response
            success : function(json) {
                console.log(json); // log the returned json to the console
                if(json.status == "success"){
                  self.statement_dashboard = json.data
                  self.ToastSuccess('Success', 'Get Statements')
                }
            },

            // handle a non-successful response
            error : function(xhr,errmsg,err) {
                console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
                this.callProcess = 'we have an erorr while getting data'
            }
        });
      },
      SetWindowTabStatus(status){
        this.window_tab_status=status
      },
      ToastSuccess: function(header_msg, body_message){
       $.toast({
         heading: header_msg,
         text: body_message,
         position: 'top-right',
         loaderBg:'#ff6849',
         icon: 'success',
         hideAfter: 1500,
         stack: 6
       });
      },
      ToastDanger: function(header_msg, body_message){
       $.toast({
         heading: header_msg,
         text: body_message,
         position: 'top-right',
         loaderBg:'#ff6849',
         icon: 'error',
         hideAfter: 2800
       });
      }
    }
  })
  
  $(document).ready(function(){
    setInterval(function () {
      app.getBucketCount();
    }, 120000)
  });

  // Active
   window.addEventListener('focus', ActionActiveTab);

   // Inactive
   window.addEventListener('blur', ActionInactiveTab);

  function ActionActiveTab(){
    console.log('Active tab')
    app.SetWindowTabStatus(true);
  }
  function ActionInactiveTab(){
    console.log('Inactive tab')
    app.SetWindowTabStatus(false);
  }
</script>
{% endblock %}