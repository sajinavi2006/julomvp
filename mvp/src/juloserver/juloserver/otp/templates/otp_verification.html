{% load static %}
<html lang="id" xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml"
    style="color-scheme: light dark;">

<head>
    <meta charset="utf-8">
    <meta name="x-apple-disable-message-reformatting">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="format-detection" content="telephone=no, date=no, address=no, email=no, url=no">
    <meta name="color-scheme" content="light dark">
    <meta name="supported-color-schemes" content="light dark">
    <!--[if mso]>
  <noscript>
    <xml>
      <o:OfficeDocumentSettings xmlns:o="urn:schemas-microsoft-com:office:office">
        <o:PixelsPerInch>96</o:PixelsPerInch>
      </o:OfficeDocumentSettings>
    </xml>
  </noscript>
  <style>
    td,th,div,p,a,h1,h2,h3,h4,h5,h6 {font-family: "Segoe UI", sans-serif; mso-line-height-rule: exactly;}
  </style>
  <![endif]-->
    <style>
        :root {
            color-scheme: light dark;
        }

        @media (max-width: 600px) {}

        @font-face {
            font-family: 'Nunito';
            font-style: normal;
            font-weight: 400;
            font-display: swap;
            src: url(https://fonts.gstatic.com/s/nunito/v25/XRXV3I6Li01BKofINeaBTMnFcQ.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
        }

        @font-face {
            font-family: 'Nunito';
            font-style: normal;
            font-weight: 700;
            font-display: swap;
            src: url(https://fonts.gstatic.com/s/nunito/v25/XRXV3I6Li01BKofINeaBTMnFcQ.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
        }

        .otp-form {
            max-width: 350px;
            margin: auto;
        }

        .input-field {
            margin-bottom: 8px;
        }

        .input-field label {
            display: block;
            font-size: 12px;
            font-weight: bold;
            color: black;
        }

        .input-field input {
            width: 100%;
            transition-property: all;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 150ms;
            border-radius: 8px;
            border: 1px solid #E0E0E0;
            font-weight: 400;
            font-size: 14px;
            line-height: 14px;
            padding: 12px;
            margin-top: 4px;
            min-height: 46px;
            background-color: white;
            color: black;
        }

        .input-field input:read-only {
            background-color: #EDEDED;
            color: #757575;
        }

        .warning {
            display: flex;
            align-items: start;
            width: 100%;
            border: 1px solid #FABF88;
            border-radius: 8px;
            padding: 8px 12px;
            box-sizing: border-box;
            margin: 16px 0px;
            background-color: #FDE5CE;
        }

        .warning span {
            font-size: 12px;
            color: #C6782E;
        }

        button {
            font-family: Nunito, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', sans-serif;
            background-color: #00ACF0;
            width: 100%;
            font-size: 16px;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            border-color: transparent;
            font-weight: bold;
            cursor: pointer;
        }

        button.disable {
            pointer-events: none;
            background-color: #EDEDED;
        }

        .eye {
            cursor: pointer;
            position: absolute;
            top: 22px;
            right: 2%;
            width: 15px;
        }

        .eye.off {
            top: 21px;
        }

        .error {
            font-size: 10px;
            color: #DB4D3D;
            margin-top: 4px;
        }

        #warning-otp {
            margin-top: 10px;
            text-align: center;
            position: absolute;
            transform: translateX(-50%);
            left: 50%;
        }

        input.err {
            border: 1px solid #DB4D3D;
        }

        textarea:focus,
        input:focus {
            outline: none;
        }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type=number] {
            -moz-appearance: textfield;
        }

        #headerbrand img {
            width: 80px;
            height: 40px;
            margin-left: 20px;
            margin-top: 10px;
            margin-bottom: 10px;
            margin: 13px 20px;
        }

        .fake-inputs {
            display: flex;
            margin-top: 8px;
            justify-content: center;
            background: white;
            gap: 8px;
        }

        .otp-fake-input {
            border: 1px solid #E0E0E0;
            border-radius: 8px;
            width: 48px !important;
            height: 46px !important;
            color: #181818;
            font-size: 14px;
        }

        .otp-fake-input.error {
            border: 1px solid #DB4D3D;
            pointer-events: none;
        }

        .otp-fake-input.otpdesigner__focus__ {
            border: 1px solid #66CDF6 !important;
        }

        .otp-fake-input.otpdesigner__focus__::before {
            content: '|';
            animation-name: blink;
            animation-duration: 1000ms;
            animation-iteration-count: infinite;
            opacity: 1;
            font-size: 22px;
        }

        @keyframes blink {
            0% {
                opacity: 1;
            }

            25% {
                opacity: 1;
            }

            50% {
                opacity: 1;
            }

            75% {
                opacity: 0;
            }

            100% {
                opacity: 0;
            }
        }

        .timer {
            display: flex;
            border-radius: 100px;
            background: #EDEDED;
            gap: 4px;
            padding: 6px;
            width: 48px;
            align-items: center;
            margin: auto;
            margin-top: 30px;
        }

        .timer .time {
            font-size: 10px;
            font-weight: bold;
            color: #404040;
        }

        .resend {
            font-size: 14px;
            font-weight: bold;
            color: #404040;
            margin-top: 24px;
            text-align: center;
        }

        .resend span {
            color: #00ACF0;
            cursor: pointer;
        }

        .resend span.disable {
            color: #C2C2C2;
            pointer-events: none;
        }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
</head>

<body
    style="font-family: Nunito, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', sans-serif; -webkit-font-smoothing: antialiased; word-break: break-word; margin: 0; width: 100%; background-color: #fff; padding: 0">
    <div id="headerbrand" style="background: #00ACF0;"><img alt="julo"
            src="https://www.julo.co.id/sites/default/files/newsletter/ic-logo-julo.png" /></div>
    <div style="margin-left:12px; margin-right:12px;">
        <div class="warning">
            <img width="16" height="16" src="https://www.julo.co.id/sites/default/files/lupa-pin/ic-warning.svg">
            <span style="margin:0;padding-left: 10px;">
                Jangan berikan kode OTP kepada siapa pun
            </span>
        </div>
        <div class="otp-form">
            <p style="font-size: 12px; text-align:center; color:black;margin-top:0">
                Harap masukkan kode OTP yang telah kami kirim ke nomor <br> {{masked_phone}}untuk melanjutkan proses
            </p>
            <div>
                <div id="otp-input"></div>
            </div>
            <div class="timer">
                <img alt="clock" src="https://www.julo.co.id/sites/default/files/lupa-pin/ic-clock.svg" />
                <div class="time"></div>
            </div>
            <div class="resend">
                Tidak menerima kode? <span class="disable">Kirim Ulang</span>
            </div>
        </div>
    </div>
    <script src="{% static 'default/js/otpdesigner.min.js' %}"></script>
    <script>
        var countdownTimer = {{ resend_time_second }};

        function displayError(inputEl, msgId, text) {
            if($('#warning-otp').length > 0){
                $('#warning-otp').remove();
            }
            inputEl.insertAdjacentHTML('afterend', '<div class="error" id="warning-' + msgId + '">' + text + '</div>');
            $('.otp-fake-input').addClass('error');

            setTimeout(() => {
                $('#otp-input').otpdesigner('clear');
                $('.otp-fake-input').removeClass('error');
            }, 1500);
        }

        function countdown(totalSeconds) {
            var end = false;
            var interval = setInterval(function () {
                min = parseInt(totalSeconds / 60, 10)
                sec = parseInt(totalSeconds % 60, 10);

                min = min < 10 ? "0" + min : min;
                sec = sec < 10 ? "0" + sec : sec;

                if (totalSeconds < 0) {
                    end = true;
                    clearInterval(interval);
                    $('.resend span').removeClass('disable');
                } else {
                    $('.resend span').addClass('disable');
                    totalSeconds -= 1;
                    $('.time').html(min + ':' + sec);
                }
            }, 1000);
        }

        $(document).ready(function () {
            countdown(countdownTimer);

            $('#otp-input').otpdesigner({
                onlyNumbers: true,
                typingDone: function (code) {
                    $.ajax({
                        type: "POST",
                        async: false,
                        url: "{{ajax_send_otp_endpoint}}",
                        data: {
                            csrfmiddlewaretoken: '{{csrf_token}}',
                            otp_value: code,
                            action_type: '{{action_type}}',
                            reset_key: '{{reset_key}}',
                            phone_number: '{{phone_number}}',
                        }, // code = otp value
                        dataType: "json",
                        success: function (response) {
                            console.log(response)
                            redirect_url = "{{success_validation_redirect}}" + response.data;
                            console.log(redirect_url);
                            window.location.replace(redirect_url);
                        },
                        error: function (error) {  // check otp
                            displayError(document.querySelector('#otp-input'), 'otp', error.responseJSON.errors[0]); //error message
                        },
                    });
                },
            });

        $('.realInput').attr('inputmode','numeric');
        var errorMessage = {% if error_message %}'{{error_message}}'{% else %}null{% endif %};
        if (errorMessage) {
            displayError(document.querySelector('#otp-input'), 'otp', errorMessage);
        }

        $('.resend span').click(function () {
            window.location.reload()
        });
    });
    </script>
</body>

</html>