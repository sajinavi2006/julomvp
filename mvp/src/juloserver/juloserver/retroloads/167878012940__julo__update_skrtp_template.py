# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2022-10-11 03:38
from __future__ import unicode_literals

from django.db import migrations
from juloserver.followthemoney.constants import LoanAgreementType
from django.conf import settings

from juloserver.followthemoney.models import LoanAgreementTemplate

def update_skrtp_default_template(apps, _schema_editor):
    template_dir = '/juloserver/julo/templates/loan_agreement/julo_one_skrtp.html'
    with open(settings.BASE_DIR + template_dir, "r") as file:
        basehtml = file.read()

    data_lender = [{
        "company": "PT Julo Teknologi Perdana",
        "lendername": "Julo Teknologi Perdana",
        "izin": "9120008631626",
        "alamat": "Eightyeight @kasablanka office tower Lt. 10 Unit E, Jl. Casablanca Raya Kav. 88, Menteng Dalam, Tebet, DKI Jakarta",
        "nama": "Thadea Silvana",
        "signature": "jtp",
        "file": "jtp",
    },
    {
        "company": "Julo Holdings Pte. Ltd.",
        "lendername": "Julo Holding",
        "izin": "201809592H",
        "alamat": "1 Raffles Place, One Raffles Place Singapore",
        "nama": "Hans Sebastian",
        "signature": "pascal",
        "file": "jh",
    },
    {
        "company": "Pascal International Pte. Ltd.",
        "lendername": "Pascal",
        "izin": "202116624E",
        "alamat": "6 Battery Road, Singapore",
        "nama": "Hans Sebastian",
        "signature": "pascal",
        "file": "pascal",
    },
    {
        "company": "",
        "lendername": "",
        "izin": "",
        "alamat": "",
        "nama": "",
        "file": "",
    }]

    for lender in data_lender:
        html = basehtml
        for key, value in lender.items():
            html = html.replace('{{ %s }}' % key, value)
        filter = {"agreement_type": "skrtp"}
        if lender['file']:
            filter["lender__lender_name"] = lender['file']
        else:
            filter["lender"] = None
        agreement_template = LoanAgreementTemplate.objects.filter(**filter).last()
        if agreement_template:
            agreement_template.update_safely(body=html, is_active=True)


class Migration(migrations.Migration):

    dependencies = [
    ]

    operations = [
        migrations.RunPython(update_skrtp_default_template, migrations.RunPython.noop)
    ]
