# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2024-07-11 11:44
from __future__ import unicode_literals

from django.db import migrations

from juloserver.julo.models import Partner
from juloserver.merchant_financing.scripts.retroload_new_mf_partner import retroload_new_mf_partner
from juloserver.partnership.constants import PartnershipFlag
from juloserver.partnership.models import PartnershipFlowFlag
from juloserver.portal.object.bulk_upload.constants import (
    MerchantFinancingCSVUploadPartner,
    MerchantFinancingCSVUploadPartnerDueDateType,
)


def add_partner_venteny(apps, schema_editor):
    retroload_new_mf_partner(
        MerchantFinancingCSVUploadPartner.VENTENY,
        default_user_email='tatik_nurhalisah@venteny.com',
        default_ops_email='ops.venteny@julo.co.id',
        app_190_email_recipients='',
        disburse_email_recipients='',
        due_date_type=MerchantFinancingCSVUploadPartnerDueDateType.END_OF_TENOR,
        partner_bank_account_number='',
        partner_bank_account_name='',
        partner_bank_name='',
    )


def add_disbursement_configuration_partnership_flow_flag(apps, schema_editor):
    partner = Partner.objects.filter(name=MerchantFinancingCSVUploadPartner.VENTENY).last()
    if not partner:
        return

    PartnershipFlowFlag.objects.get_or_create(
        partner=partner,
        name=PartnershipFlag.DISBURSEMENT_CONFIGURATION,
        configs={'disburse_to_merchant': True},
    )


class Migration(migrations.Migration):

    operations = [
        migrations.RunPython(add_partner_venteny, migrations.RunPython.noop),
        migrations.RunPython(
            add_disbursement_configuration_partnership_flow_flag, migrations.RunPython.noop
        ),
    ]
