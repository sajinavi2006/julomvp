# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2024-11-20 05:23
from __future__ import unicode_literals

from django.db import migrations
from django.contrib.auth.models import Group

from juloserver.application_flow.constants import PartnerNameConstant
from juloserver.julo.models import AuthUser as User
from juloserver.julo.models import Partner
from juloserver.julo.models import FeatureSetting
from juloserver.julo.constants import FeatureNameConst
from juloserver.partnership.constants import PartnershipProductFlow, AgentAssistedEmailFlowConfig
from juloserver.partnership.models import PartnershipFlowFlag


def create_qoala_partner(apps, schema_editor):
    group = Group.objects.get(name="julo_partners")

    user = User.objects.create(
        username=PartnerNameConstant.QOALA,
        email='edo.alfiyanus@qoala.id',
    )
    user.groups.add(group)

    partner = Partner.objects.create(
        user=user,
        poc_email='edo.alfiyanus@qoala.id',
        poc_phone='+628111111111',
        poc_name='Edo Alfiyanus',
        name=PartnerNameConstant.QOALA,
        email='edo.alfiyanus@qoala.id',
        phone='+628111111111',
        type='referrer',
        company_name='PT. Mitra Jasa Pratama',
        company_address='Jl. H. R. Rasuna Said No.16-17, RT.3/RW.2, Kuningan Tim., Kecamatan Setiabudi, Kota Jakarta Selatan, Daerah Khusus Ibukota Jakarta 12710',
        business_type='Fintech Aggregator',
        is_active=True,
    )

    feature_settings = FeatureSetting.objects.filter(
        feature_name=FeatureNameConst.LEAD_GEN_PARTNER_CREDIT_SCORE_GENERATION
    ).first()

    partners = feature_settings.parameters['partners']
    if PartnerNameConstant.QOALA not in partners:
        partners.append(PartnerNameConstant.QOALA)
        feature_settings.parameters['partners'] = partners
        feature_settings.save()

    PartnershipFlowFlag.objects.get_or_create(
        partner=partner,
        name=PartnershipProductFlow.AGENT_ASSISTED,
        configs={
            AgentAssistedEmailFlowConfig.APPROVED_AGENT_ASSISTED_EMAIL: True,
            AgentAssistedEmailFlowConfig.REJECT_AGENT_ASSISTED_EMAIL: True,
            AgentAssistedEmailFlowConfig.FORM_SUBMITTED_AGENT_ASSISTED_EMAIL: True,
            "provider": {
                "indosat": {
                    "is_active": True,
                    "prefixes": ["0814", "0815", "0816", "0855", "0856", "0857", "0858"],
                    "swap_in_threshold": 750,
                },
                "telkomsel": {
                    "is_active": True,
                    "prefixes": ["0811", "0812", "0821", "0822", "0823", "0851", "0852", "0853"],
                    "swap_in_threshold": 750,
                },
                "xl": {
                    "is_active": True,
                    "prefixes": ["0877", "0878", "0817", "0818", "0819"],
                    "swap_in_threshold": 750,
                },
            },
        },
    )

class Migration(migrations.Migration):
    dependencies = []

    operations = [migrations.RunPython(create_qoala_partner, migrations.RunPython.noop)]
