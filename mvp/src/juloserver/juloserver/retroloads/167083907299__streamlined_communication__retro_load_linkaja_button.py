# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2022-12-12 09:57
from __future__ import unicode_literals

from django.db import migrations
from juloserver.streamlined_communication.models import (InfoCardButtonProperty,
                                                         CardProperty,
                                                         InfoCardProperty,
                                                         StreamlinedMessage,
                                                         StreamlinedCommunication)
from juloserver.julo.models import StatusLookup
from juloserver.julo.statuses import ApplicationStatusCodes
from juloserver.streamlined_communication.constant import CommunicationPlatform, CardProperty

M_BUTTON = 'M.BUTTON'


def retroload_linkaja_button(apps, _schema_editor):
    linkaja_partner = None
    data = {
        'status': ApplicationStatusCodes.FORM_CREATED,
        'additional_condition': CardProperty.PARTNERSHIP_WEBVIEW_INFO_CARD_BUTTON_FOR_LINKAJA,
        'title': 'Muat Ulang',
        'content': 'Muat Ulang',
        'button': ['Muat Ulang'],
        'button_name': [M_BUTTON],
        'click_to': [],
        'template_type': '2',
        'card_number': 1,
        'text_colour': '#ffffff',
        'title_colour': '#ffffff',
        'additional_images': [],
        'button_url': [],
        'show_in_web': True,
        'show_in_android': False,
        'partner': linkaja_partner
    }

    button_2_properties = {'card_type': '2',
                           'title': data['title'],
                           'title_color': data['title_colour'],
                           'text_color': data['text_colour'],
                           'card_order_number': data['card_number']}
    info_card = InfoCardProperty.objects.create(**button_2_properties)
    button_info_card = dict()
    if data['button']:
        for idx in enumerate(data['button']):
            button_info_card['info_card_property'] = info_card
            button_info_card['text'] = data['button'][0]
            button_info_card['button_name'] = data['button_name'][0]
            button_info_card['action_type'] = CardProperty.RELOAD
            button_info_card['destination'] = ''
            button_info_card['text_color'] = '#13637b'
            button, _ = InfoCardButtonProperty.objects.get_or_create(**button_info_card)

    data_streamlined_message = {'message_content': data['content'],
                                'info_card_property': info_card}
    message = StreamlinedMessage.objects.create(**data_streamlined_message)
    status = StatusLookup.objects.filter(status_code=data['status']).last()
    data_for_streamlined_comms = {'status_code': status,
                                  'status': data['status'],
                                  'communication_platform': CommunicationPlatform.INFO_CARD,
                                  'message': message,
                                  'description': 'retroloaded_card_information',
                                  'is_active': True,
                                  'extra_conditions': data['additional_condition'],
                                  'show_in_web': data['show_in_web'],
                                  'show_in_android': data['show_in_android'],
                                  'partner': data['partner']}
    StreamlinedCommunication.objects.create(**data_for_streamlined_comms)


class Migration(migrations.Migration):
    dependencies = [
    ]

    operations = [
        migrations.RunPython(retroload_linkaja_button, migrations.RunPython.noop)
    ]
