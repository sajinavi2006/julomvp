# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2023-10-10 14:04
from __future__ import unicode_literals

from django.db import migrations
from juloserver.julo.models import FeatureSetting
from juloserver.minisquad.constants import (
    FeatureNameConst,
    DialerSystemConst,
)


def add_bucket_0_to_ai_rudder_feature_setting(apps, schema_editor):
    feature_group_mapping_config = FeatureSetting.objects.filter(
        feature_name=FeatureNameConst.AI_RUDDER_FULL_ROLLOUT).last()
    if not feature_group_mapping_config:
        return
    feature_group_mapping_config.refresh_from_db()
    params = feature_group_mapping_config.parameters
    eligible_buckets = params['eligible_bucket_number']
    eligible_buckets.append(0)
    params['eligible_bucket_number'] = eligible_buckets
    feature_group_mapping_config.parameters = params
    feature_group_mapping_config.save()

    feature_batching_threshold_group_config = FeatureSetting.objects.filter(
        feature_name=FeatureNameConst.AI_RUDDER_SEND_BATCHING_THRESHOLD).last()
    if not feature_batching_threshold_group_config:
        return

    params_threshold = feature_batching_threshold_group_config.parameters
    params_threshold[DialerSystemConst.DIALER_BUCKET_0] = 5000
    feature_batching_threshold_group_config.parameters = params_threshold
    feature_batching_threshold_group_config.save()

    feature_group_config = FeatureSetting.objects.filter(
        feature_name=FeatureNameConst.AI_RUDDER_GROUP_NAME_CONFIG).last()
    if not feature_group_config:
        return

    params_feature_group_config = feature_group_config.parameters
    params_feature_group_config[DialerSystemConst.DIALER_BUCKET_0] = "Group_Bucket Reminder"
    feature_group_config.parameters = params_feature_group_config
    feature_group_config.save()

    feature_ai_rudder_tasks_config = FeatureSetting.objects.filter(
        feature_name=FeatureNameConst.AI_RUDDER_TASKS_STRATEGY_CONFIG).last()
    if feature_ai_rudder_tasks_config:
        return

    feature_ai_rudder_tasks_config_params = feature_ai_rudder_tasks_config.parameters
    t0_config = {
        "autoQA": "Y",
        "acwTime": "20",
        "end_time": "20:00",
        "ringLimit": "0",
        "qaConfigId": 142,
        "rest_times": [
            ["12:00", "13:00"]
        ],
        "resultStrategies": "off",
        "start_time": "11:50",
        "dialingMode": "0",
        "maxLostRate": "5",
        "repeatTimes": "5",
        "callInterval": "0",
        "dialingOrder": ["mobile_phone_1_2"],
        "autoSlotFactor": "1",
        "bulkCallInterval": "300",
        "contactNumberInterval": "300"
    }
    feature_ai_rudder_tasks_config_params[DialerSystemConst.DIALER_BUCKET_0] = t0_config
    feature_ai_rudder_tasks_config.parameters = feature_ai_rudder_tasks_config_params
    feature_ai_rudder_tasks_config.save()


class Migration(migrations.Migration):

    dependencies = [
    ]

    operations = [
        migrations.RunPython(add_bucket_0_to_ai_rudder_feature_setting, migrations.RunPython.noop)
    ]
