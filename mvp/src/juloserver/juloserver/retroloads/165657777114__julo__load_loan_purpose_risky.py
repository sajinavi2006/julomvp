# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2022-06-30 08:29
from __future__ import unicode_literals

from django.db import (migrations, transaction)
from juloserver.julo.models import (ProductLine,
                                    LoanPurpose,
                                    ProductLineLoanPurpose)


def add_new_loan_purpose_risky(apps, schema_editor):
    """
    Set Product line code for J1
    product_line_code = 10 / product_profile_id = 1
    """

    pd_line_code = 10
    new_loan_purpose = "Investasi saham, forex, crypto"
    product = ProductLine.objects.get_or_none(pk=pd_line_code)
    if product:
        with transaction.atomic():
            # checking data
            loan_purpose_exist = LoanPurpose.objects.get_or_none(purpose=new_loan_purpose)
            if not loan_purpose_exist:
                # create data
                loan_purpose = LoanPurpose.objects.create(purpose=new_loan_purpose)
            # check relation
            related = ProductLineLoanPurpose.objects.get_or_none(product_line=product,
                                                                 loan_purpose=loan_purpose)
            if not related:
                ProductLineLoanPurpose.objects.create(product_line=product,
                                                      loan_purpose=loan_purpose)


class Migration(migrations.Migration):


    dependencies = [
    ]

    operations = [
        migrations.RunPython(add_new_loan_purpose_risky, migrations.RunPython.noop)
    ]
