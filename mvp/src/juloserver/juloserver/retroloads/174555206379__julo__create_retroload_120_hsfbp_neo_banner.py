# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2025-04-25 03:34
from __future__ import unicode_literals

from django.db import migrations
from django.conf import settings

from juloserver.streamlined_communication.models import NeoBannerCard
from juloserver.julo.models import Image
from juloserver.julo.utils import upload_file_to_oss

STATIC_FOLDER_DIR_OSS = 'neo-banner'


class ImageNames(object):
    BANNER_NAME = 'JULO-neo-banner-120-hsfbp.png'
    BANNER_PATH = '{0}/{1}'.format(STATIC_FOLDER_DIR_OSS, BANNER_NAME)


def create_image(image_source_id, image_type, image_url):
    image = Image()
    image.image_source = image_source_id
    image.image_type = image_type
    image.url = image_url
    image.save()


def retroload_neo_banner(apps, schema_editor):
    neo_banner_data = {
        'statuses': '[120_HSFBP]',
        'product': 'J1',
        'template_card': 'B_BUTTON',
        'top_image': ImageNames.BANNER_PATH,
        'top_title': 'Tinggal Sedikit Lagi, Nih!',
        'top_message': 'Kamu berkesempatan untuk dapet diskon bunga 20%! Yuk, upload sekarang juga!',
        'button_text': 'Foto Dokumen',
        'button_action': 'x120_hsfbp',
        'extended_image': None,
        'extended_title': None,
        'extended_message': None,
        'extended_button_text': None,
        'extended_button_action': None,
        'top_info_icon': None,
        'top_info_title': None,
        'top_info_message': None,
        'is_active': True,
    }

    neo_banner_card = NeoBannerCard.objects.create(**neo_banner_data)
    create_image(
        neo_banner_card.id, 'NEO_BANNER_TOP_BACKGROUND_IMAGE', neo_banner_data['top_image']
    )

    upload_file_to_oss(
        settings.OSS_PUBLIC_ASSETS_BUCKET,
        settings.STATICFILES_DIRS[0] + '/images/neo_banner/{}'.format(ImageNames.BANNER_NAME),
        ImageNames.BANNER_PATH,
    )


class Migration(migrations.Migration):

    dependencies = []

    operations = [
        migrations.RunPython(retroload_neo_banner, migrations.RunPython.noop),
    ]
