# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2023-06-08 10:39
from __future__ import unicode_literals

from django.db import migrations

from juloserver.streamlined_communication.constant import CommunicationPlatform
from juloserver.streamlined_communication.models import StreamlinedCommunication


def duplicate_j1_to_jturbo(streamlined_comm):
    if 'j1' not in streamlined_comm.template_code:
        return

    message = streamlined_comm.message
    message.id = None
    message.save()

    streamlined_comm.id = None
    streamlined_comm.message_id = message.id
    streamlined_comm.product = 'jturbo'
    streamlined_comm.template_code = streamlined_comm.template_code.replace('j1', 'jturbo')
    streamlined_comm.save()


def duplicate_normal_dpd_sms_j1_to_jturbo(*args):
    streamlined_comms = StreamlinedCommunication.objects.filter(
        communication_platform=CommunicationPlatform.SMS,
        time_sent__isnull=False,
        is_automated=True,
        ptp__isnull=True,
        product='j1',
    ).select_related('message')
    for streamlined_comm in streamlined_comms:
        duplicate_j1_to_jturbo(streamlined_comm)


def duplicate_ptp_sms_j1_to_jturbo(*args):
    streamlined_comms = StreamlinedCommunication.objects.filter(
        communication_platform=CommunicationPlatform.SMS,
        time_sent__isnull=False,
        is_automated=True,
        extra_conditions__isnull=True,
        dpd__isnull=True,
        ptp__isnull=False,
        product='j1',
    ).exclude(ptp='real-time').select_related('message')
    for streamlined_comm in streamlined_comms:
        duplicate_j1_to_jturbo(streamlined_comm)


class Migration(migrations.Migration):

    dependencies = [
    ]

    operations = [
        migrations.RunPython(duplicate_normal_dpd_sms_j1_to_jturbo, migrations.RunPython.noop),
        migrations.RunPython(duplicate_ptp_sms_j1_to_jturbo, migrations.RunPython.noop)
    ]
