# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2021-06-07 00:04
from __future__ import unicode_literals

from django.db import migrations

from juloserver.streamlined_communication.models import StreamlinedCommunication, StreamlinedMessage
from juloserver.streamlined_communication.constant import CommunicationPlatform, TemplateCode


def add_pn_cashback_expired(apps, schema_editor):
    comms_data = {
        TemplateCode.CASHBACK_EXPIRED_1: 60,
        TemplateCode.CASHBACK_EXPIRED_2: 30,
        TemplateCode.CASHBACK_EXPIRED_3: 7,
        TemplateCode.CASHBACK_EXPIRED_4: 1,
    }
    message, _ = \
        StreamlinedMessage.objects.get_or_create(
            message_content="Gunakan cashback Anda sebesar IDR {{ current_balance }} sebelum "
                            "tanggal {{ expired_on_date }} karena akan kadaluarsa",
            parameter="{current_balance,expired_on_date}"
        )
    for template_code in comms_data:
        StreamlinedCommunication.objects.get_or_create(
            message=message,
            dpd=comms_data[template_code],
            status='inform customer when cashback will be expired on {} days'.format(
                comms_data[template_code]
            ),
            communication_platform=CommunicationPlatform.PN,
            template_code=template_code,
            description='this PN called when cashback will be expired on {} days'.format(
                comms_data[template_code]
            ),
            type='Information',
            time_sent='9:30',
            is_automated=True,
            is_active=True
        )


class Migration(migrations.Migration):

    dependencies = [
    ]

    operations = [
        migrations.RunPython(add_pn_cashback_expired,
                             migrations.RunPython.noop)
    ]
