# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2025-02-24 03:36
from __future__ import unicode_literals

from django.db import migrations
from juloserver.followthemoney.models import LenderCurrent
from juloserver.julo.models import AuthUser, Partner, FeatureSetting
from juloserver.julo.constants import FeatureNameConst

USERNAME = 'saison_modern_finance_lender'


def update_saison_channeling_lender(apps, schema_editor):
    smf_channeling = LenderCurrent.objects.get_or_none(lender_name='smf_channeling')

    user = AuthUser.objects.filter(username=USERNAME).last()
    if user:
        user.email = smf_channeling.poc_email
        user.save()

    partner = Partner.objects.get_or_none(user=user)
    if partner:
        partner.email = smf_channeling.poc_email
        partner.company_address = smf_channeling.lender_address
        partner.company_name = smf_channeling.company_name
        partner.poc_email = smf_channeling.poc_email
        partner.poc_name = smf_channeling.poc_name
        partner.poc_phone = smf_channeling.poc_phone
        partner.save()

    lender = LenderCurrent.objects.get_or_none(user=user)
    if lender:
        lender.lender_address = smf_channeling.lender_address
        lender.poc_email = smf_channeling.poc_email
        lender.poc_name = smf_channeling.poc_name
        lender.poc_phone = smf_channeling.poc_phone
        lender.poc_position = smf_channeling.poc_position
        lender.lender_display_name = smf_channeling.lender_display_name
        lender.company_name = smf_channeling.company_name
        lender.license_number = smf_channeling.license_number
        lender.save()


def update_list_lender_info_fs_for_saison_channeling_lender(apps, schema_editor):
    smf_channeling = LenderCurrent.objects.get_or_none(lender_name='smf_channeling')

    feature_setting = FeatureSetting.objects.filter(
        feature_name=FeatureNameConst.LIST_LENDER_INFO
    ).last()
    if feature_setting:
        feature_setting.parameters['lenders'][USERNAME]['address'] = smf_channeling.lender_address
        feature_setting.parameters['lenders'][USERNAME]['poc_name'] = smf_channeling.poc_name
        feature_setting.parameters['lenders'][USERNAME][
            'license_no'
        ] = smf_channeling.license_number
        feature_setting.parameters['lenders'][USERNAME][
            'poc_position'
        ] = smf_channeling.poc_position
        feature_setting.save()


class Migration(migrations.Migration):

    dependencies = []

    operations = [
        migrations.RunPython(update_saison_channeling_lender, migrations.RunPython.noop),
        migrations.RunPython(
            update_list_lender_info_fs_for_saison_channeling_lender, migrations.RunPython.noop
        ),
    ]
