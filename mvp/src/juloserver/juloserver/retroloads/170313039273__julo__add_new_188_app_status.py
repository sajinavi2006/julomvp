# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2023-12-21 03:46
from __future__ import unicode_literals

from django.db import migrations
from juloserver.julo.constants import WorkflowConst
from juloserver.julo.models import WorkflowStatusPath, Workflow, StatusLookup, WorkflowStatusNode


def initial_data(apps, schema_editor):
    is_status_node_exist = StatusLookup.objects.filter(
        status_code=StatusLookup.MISSING_EMERGENCY_CONTACT
    ).exists()
    if not is_status_node_exist:
        StatusLookup.objects.create(
            status_code=StatusLookup.MISSING_EMERGENCY_CONTACT,
            status="Missing emergency contact",
            handler="JuloOne188Handler"
        )

    workflow = Workflow.objects.filter(name=WorkflowConst.JULO_ONE).last()
    is_workflow_status_node_exist = WorkflowStatusNode.objects.filter(
        status_node=188,
        handler="JuloOne188Handler",
        workflow=workflow
    ).exists()

    if not is_workflow_status_node_exist:
        WorkflowStatusNode.objects.create(
            status_node=188,
            handler="JuloOne188Handler",
            workflow=workflow
        )

    WorkflowStatusPath.objects.get_or_create(
        workflow=workflow,
        status_previous=150,
        status_next=188,
        type="unhappy"
    )

    WorkflowStatusPath.objects.get_or_create(
        workflow=workflow,
        status_previous=153,
        status_next=188,
        type="unhappy"
    )


class Migration(migrations.Migration):
    dependencies = [
    ]

    operations = [
        migrations.RunPython(initial_data, migrations.RunPython.noop),
    ]
