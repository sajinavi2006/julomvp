# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2024-06-20 04:59
from __future__ import unicode_literals

from django.db import migrations, transaction
from juloserver.streamlined_communication.models import AppDeepLink
from juloserver.streamlined_communication.constant import (
    CardProperty,
    PageType,
    CommunicationPlatform,
    TemplateCode,
)
from juloserver.streamlined_communication.models import (
    InfoCardProperty,
    StreamlinedMessage,
    StreamlinedCommunication,
)
from juloserver.julo.models import (
    Image,
)


def create_autodebet_streamlined_idfy(apps, schema_editor):
    for deeplink, label in CardProperty.APP_DEEPLINK_CHOICES:
        if (
            deeplink == PageType.AUTODEBET_IDFY
            and not AppDeepLink.objects.filter(label=label, deeplink=deeplink).exists()
        ):
            AppDeepLink.objects.create(label=label, deeplink=deeplink)

    with transaction.atomic():
        info_card_parameter = dict(
            title="‎",
            title_color="#ffffff",
            text_color="#ffffff",
            card_type="1",
            card_action="app_deeplink",
            card_destination="autodebet_idfy",
            card_order_number=1,
        )
        info_card_property = InfoCardProperty.objects.create(**info_card_parameter)

        image = Image()
        image.image_source = info_card_property.id
        image.image_type = CardProperty.IMAGE_TYPE.card_background_image
        image.url = "info-card/Artboard%202%20copy%2016%404x%203.png"
        image.save()

        streamlined_content = StreamlinedMessage.objects.create(
            message_content="", parameter="{}", info_card_property=info_card_property
        )

        streamlined_parameters = dict(
            template_code="idfy_autodebet_not_active",
            communication_platform=CommunicationPlatform.INFO_CARD,
            extra_conditions=CardProperty.AUTODEBET_NOT_ACTIVE_JTURBO,
            product="jstarter",
            message=streamlined_content,
            is_active=True,
            show_in_android=True,
            show_in_web=False,
            bottom_sheet_destination="",
            expiration_option="No Expiration Time",
        )
        StreamlinedCommunication.objects.create(**streamlined_parameters)

    with transaction.atomic():
        info_card_parameter = dict(
            title="‎",
            title_color="#ffffff",
            text_color="#ffffff",
            card_type="1",
            card_action="app_deeplink",
            card_destination="autodebet_idfy",
            card_order_number=1,
        )
        info_card_property = InfoCardProperty.objects.create(**info_card_parameter)

        image = Image()
        image.image_source = info_card_property.id
        image.image_type = CardProperty.IMAGE_TYPE.card_background_image
        image.url = "info-card/Artboard%202%20copy%2016%404x%203.png"
        image.save()

        streamlined_content = StreamlinedMessage.objects.create(
            message_content="", parameter="{}", info_card_property=info_card_property
        )

        streamlined_parameters = dict(
            template_code="idfy_autodebet_not_active",
            communication_platform=CommunicationPlatform.INFO_CARD,
            extra_conditions=CardProperty.AUTODEBET_NOT_ACTIVE,
            product="J1",
            message=streamlined_content,
            is_active=True,
            show_in_android=True,
            show_in_web=False,
            bottom_sheet_destination="",
            expiration_option="No Expiration Time",
        )
        StreamlinedCommunication.objects.create(**streamlined_parameters)


class Migration(migrations.Migration):

    dependencies = []

    operations = [
        migrations.RunPython(create_autodebet_streamlined_idfy, migrations.RunPython.noop),
    ]
