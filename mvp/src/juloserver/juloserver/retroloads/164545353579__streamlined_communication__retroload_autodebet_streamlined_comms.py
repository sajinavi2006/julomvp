# -*- coding: utf-8 -*-
# Generated by Django 1.9 on 2022-02-21 14:25
from __future__ import unicode_literals

from django.db import migrations
from juloserver.streamlined_communication.models import (
       StreamlinedCommunication,
       StreamlinedMessage)
from juloserver.streamlined_communication.constant import (
       CommunicationPlatform)
from juloserver.moengage.constants import UNSENT_MOENGAGE


def update_autodebet_streamlined_comms(apps, schema_editor):
    # SMS
    streamlined_communication_for_sms_minus_7 = StreamlinedCommunication.objects.filter(
        status="Inform j1 autodebet customer when dpd -7",
        communication_platform=CommunicationPlatform.SMS,
        template_code='j1_sms_autodebet_dpd_-7',
        extra_conditions=UNSENT_MOENGAGE,
        type='Payment Reminder',
        is_automated=True
    ).last()
    if streamlined_communication_for_sms_minus_7:
        streamlined_communication_for_sms_minus_7.update_safely(dpd=-7)

    streamlined_communication_for_sms_minus_3 = StreamlinedCommunication.objects.filter(
        status="Inform j1 autodebet customer when dpd -3",
        communication_platform=CommunicationPlatform.SMS,
        template_code='j1_sms_autodebet_dpd_-3',
        extra_conditions=UNSENT_MOENGAGE,
        type='Payment Reminder',
    ).last()
    if streamlined_communication_for_sms_minus_3:
        streamlined_communication_for_sms_minus_3.update_safely(dpd=-3)

    streamlined_communication_for_sms_minus_1 = StreamlinedCommunication.objects.filter(
        status="Inform j1 autodebet customer when dpd -1",
        communication_platform=CommunicationPlatform.SMS,
        template_code='j1_sms_autodebet_dpd_-1',
        extra_conditions=UNSENT_MOENGAGE,
        type='Payment Reminder',
    ).last()
    if streamlined_communication_for_sms_minus_1:
        streamlined_communication_for_sms_minus_1.update_safely(dpd=-1)


class Migration(migrations.Migration):

    dependencies = [
    ]

    operations = [
        migrations.RunPython(
            update_autodebet_streamlined_comms, migrations.RunPython.noop),
    ]
