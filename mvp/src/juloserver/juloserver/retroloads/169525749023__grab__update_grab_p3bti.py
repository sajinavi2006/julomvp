# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2023-09-21 00:51
from __future__ import unicode_literals

from django.conf import settings
from django.db import migrations

from juloserver.followthemoney.constants import LoanAgreementType
from juloserver.followthemoney.models import LenderCurrent, LoanAgreementTemplate


def update_p3bti_for_ska(apps, schema_editor):
    lla_template_dir = '/juloserver/followthemoney/templates/grab_summary_lla_template.html'
    with open(settings.BASE_DIR + lla_template_dir, "r") as file:
        html = file.read()
    lenders = LenderCurrent.objects.filter(lender_name__in={'ska', 'ska2'})
    for lender in lenders:
        loan_agreement_template = LoanAgreementTemplate.objects.filter(
            agreement_type=LoanAgreementType.SUMMARY,
            lender=lender
        ).last()
        if loan_agreement_template:
            loan_agreement_template.body = html
            loan_agreement_template.save()


class Migration(migrations.Migration):

    dependencies = [
    ]

    operations = [
        migrations.RunPython(update_p3bti_for_ska, migrations.RunPython.noop),
    ]
