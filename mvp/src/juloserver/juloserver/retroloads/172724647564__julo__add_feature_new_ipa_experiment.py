# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2024-09-25 06:41
from __future__ import unicode_literals
from dateutil.relativedelta import relativedelta

from django.utils import timezone
from django.db import migrations

from juloserver.julo.constants import ExperimentConst
from juloserver.julo.models import ExperimentSetting


def run(apps, schema_editor):

    """
    renaming the flow:
    First flow => no_stickybar
    2nd flow => all_component
    3rd flow => no_banner
    """

    criteria = {
            "customer_id": {
                'no_stickybar': [0, 1, 2],
                'all_component': [4, 5, 6],
                'no_banner': [7, 8, 9],
            },
            "target_version": ">=8.34.0",
    }

    experiment_data = {
        'code': 'FDCIPABannerExperimentV3',
        'name': 'FDC IPA Banner Experiment V3',
        'start_date': timezone.now(),
        'end_date': timezone.now() + relativedelta(year=1),
        'is_permanent': True,
        'is_active': False,
        'type': 'IPA Banner',
        'criteria': criteria,
    }

    es = ExperimentSetting.objects.filter(code=experiment_data['code']).first()
    if es:
        es.update_safely(**experiment_data)
    else:
        ExperimentSetting.objects.create(**experiment_data)


class Migration(migrations.Migration):
    dependencies = []

    operations = [
        migrations.RunPython(run, migrations.RunPython.noop),
    ]
