# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2022-10-27 08:36
from __future__ import unicode_literals

from django.db import migrations

from juloserver.julo.models import ExperimentSetting
from juloserver.minisquad.constants import ExperimentConst


def update_collection_tailor_experiment(apps, schema_editor):
    new_parameters = {
        'is_full_rollout': True,
        'sort_method_list': [
            'elephant', 'bull', 'scorpion', 'hamster'
        ]
    }
    collection_tailor_experiment_setting = ExperimentSetting.objects.get_or_none(
        code=ExperimentConst.COLLECTION_TAILOR_EXPERIMENT
    )
    if not collection_tailor_experiment_setting:
        return
    existing_criteria = collection_tailor_experiment_setting.criteria
    del existing_criteria["model_version"]
    del existing_criteria["sort_method_start_with"]
    existing_criteria.update(new_parameters)
    collection_tailor_experiment_setting.criteria = existing_criteria
    collection_tailor_experiment_setting.is_permanent = True
    collection_tailor_experiment_setting.is_active = False
    collection_tailor_experiment_setting.save()


class Migration(migrations.Migration):

    dependencies = [
    ]

    operations = [
        migrations.RunPython(
            update_collection_tailor_experiment,
            migrations.RunPython.noop
        ),
    ]
