# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2023-09-25 11:04
from __future__ import unicode_literals

from django.db import migrations

from juloserver.julo.models import FeatureSetting
from juloserver.minisquad.constants import FeatureNameConst


def add_multiple_rest_times(apps, schema_editor):
    feature_group_mapping_config = FeatureSetting.objects.filter(
        feature_name=FeatureNameConst.AI_RUDDER_TASKS_STRATEGY_CONFIG).last()
    if not feature_group_mapping_config:
        return
    params = feature_group_mapping_config.parameters
    new_params = {}
    for key, bucket_config in params.items():
        rest_times = [
            [bucket_config.get('start_rest_time', '12:00'), bucket_config.get('end_rest_time', '13:00')]
        ]
        bucket_config['rest_times'] = rest_times
        if 'start_rest_time' in bucket_config:
            del bucket_config['start_rest_time']
        if 'end_rest_time' in bucket_config:
            del bucket_config['end_rest_time']

        if int(bucket_config['autoSlotFactor']) == 0:
            bucket_config['slotFactor'] = 0.25
        bucket_config['autoQA'] = 'Y'
        bucket_config['qaConfigId'] = 142
        new_params[key] = bucket_config
    feature_group_mapping_config.parameters = new_params
    feature_group_mapping_config.save()


class Migration(migrations.Migration):

    dependencies = [
    ]

    operations = [
        migrations.RunPython(add_multiple_rest_times, migrations.RunPython.noop)
    ]
