# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2021-01-11 05:11
from __future__ import unicode_literals

from django.db import migrations

from juloserver.julo.statuses import ApplicationStatusCodes
from juloserver.streamlined_communication.constant import CommunicationPlatform, CardProperty
from juloserver.streamlined_communication.models import StreamlinedCommunication


def add_new_reason_julo_one_135(apps, _schema_editor):
    streamlined = StreamlinedCommunication.objects.filter(
        communication_platform=CommunicationPlatform.INFO_CARD,
        status_code_id=ApplicationStatusCodes.APPLICATION_DENIED,
        extra_conditions=CardProperty.ALREADY_ELIGIBLE_TO_REAPPLY,
        is_active=True
    ).order_by('message__info_card_property__card_order_number').first()
    streamlined_message = streamlined.message
    info_card_property = streamlined_message.info_card_property
    button_info_card_property = info_card_property.infocardbuttonproperty_set.first()
    button_info_card_property.destination = 'reapply_j1'
    button_info_card_property.save()


class Migration(migrations.Migration):

    dependencies = [
    ]

    operations = [
        migrations.RunPython(add_new_reason_julo_one_135,
                             migrations.RunPython.noop)
    ]
