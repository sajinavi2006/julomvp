# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2023-10-24 06:18
from __future__ import unicode_literals

from django.db import migrations

from juloserver.application_flow.services2.bank_statement import BankStatementClient
from juloserver.application_flow.models import ApplicationTag, ApplicationPathTagStatus
from juloserver.julo.models import WorkflowStatusPath, Workflow
from juloserver.julo.constants import WorkflowConst


def add_application_tag(apps, schema_editor):
    tag = BankStatementClient.APPLICATION_TAG

    if ApplicationTag.objects.filter(application_tag=tag).exists():
        return

    ApplicationTag.objects.create(application_tag=tag, is_active=True)
    ApplicationPathTagStatus.objects.create(application_tag=tag, status=1, definition="success")
    ApplicationPathTagStatus.objects.create(application_tag=tag, status=-1, definition="pending")
    ApplicationPathTagStatus.objects.create(application_tag=tag, status=0, definition="failed")

def add_workflow_128_to_121(apps, schema_editor):
    j1_workflow = Workflow.objects.filter(name=WorkflowConst.JULO_ONE).last()
    has_path = WorkflowStatusPath.objects.filter(
        workflow=j1_workflow, status_previous=128, status_next=121
    ).exists()
    if has_path:
        return
    
    WorkflowStatusPath.objects.create(
        workflow=j1_workflow, status_previous=128, status_next=121,
        type="happy"
    )

class Migration(migrations.Migration):

    dependencies = [
    ]

    operations = [
        migrations.RunPython(
            add_application_tag, migrations.RunPython.noop
        ),
        migrations.RunPython(
            add_workflow_128_to_121, migrations.RunPython.noop
        )
    ]
