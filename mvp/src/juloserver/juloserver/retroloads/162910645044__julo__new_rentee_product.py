# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2020-09-22 09:24
from django.db import migrations
from django.contrib.auth.models import User, Group

from juloserver.julo.models import (
    ProductLine,
    Partner,
    ProductProfile,
    ProductLookup,
    Customer
)

from juloserver.julo.partners import PartnerConstant
from juloserver.disbursement.models import NameBankValidation
from juloserver.customer_module.models import BankAccountDestination


def add_partner_rentee(apps, _schema_editor):

    product_profile = ProductProfile.objects.create(
        name="RENTEE",
        min_amount=500000,
        max_amount=10000000,
        min_duration=12,
        max_duration=12,
        min_interest_rate=0.36,
        max_interest_rate=0.36,
        interest_rate_increment=0,
        payment_frequency="Monthly",
        min_origination_fee=0,
        max_origination_fee=0.08,
        origination_fee_increment=0,
        late_fee=0,
        cashback_initial=0,
        cashback_payment=0,
        is_active=True,
        debt_income_ratio=0,
        is_product_exclusive=True,
        is_initial=True,
        code=105
    )

    product_line = ProductLine.objects.create(
        product_line_code=105,
        product_line_type='RENTEE',
        min_amount=0,
        max_amount=0,
        min_duration=12,
        max_duration=12,
        min_interest_rate=0,
        max_interest_rate=0,
        payment_frequency='Monthly',
        amount_increment=100000,
        product_profile=product_profile
    )

    ProductLookup.objects.create(
        product_name='I.360-O.000-L.000-C1.000-C2.000-M',
        interest_rate=0.36,
        origination_fee_pct=0,
        late_fee_pct=0.05,
        cashback_initial_pct=0,
        cashback_payment_pct=0,
        product_line=product_line,
        product_profile=product_profile,
        is_active=True,
        eligible_amount=0,
        eligible_duration=12,
        admin_fee=400000
    )

    rentee_bank_acccount = {
        'bank_name': 'BCA',
        'name_in_bank': 'PT Erafone Artha Retailindo',
        'account_number': 2683013366,
        'bank_code': 'BCA',
        'method': 'Xfers',
        'mobile_phone': ''
    }

    partner = Partner.objects.get_or_none(name=PartnerConstant.RENTEE)
    if not partner:
        group = Group.objects.get(name="julo_partners")

        password = User.objects.make_random_password()
        user = User.objects.create_user(
            username=PartnerConstant.RENTEE,
            email='cs@rentee.com',
            password=password)
        user.groups.add(group)

        customer = Customer.objects.create(user=user, email='cs@rentee.com')

        Partner.objects.create(
            user=user, name=PartnerConstant.RENTEE, email='cs@rentee.com',
            phone='+628111111122')

        name_bank_validation = NameBankValidation.objects.create(
            bank_code=rentee_bank_acccount['bank_code'],
            account_number=rentee_bank_acccount['account_number'],
            name_in_bank=rentee_bank_acccount['name_in_bank'],
            mobile_phone=rentee_bank_acccount['mobile_phone'],
            method=rentee_bank_acccount['method']
        )

        BankAccountDestination.objects.create(
            bank_account_category_id=2,
            customer=customer,
            bank_id=1,
            account_number=rentee_bank_acccount['account_number'],
            name_bank_validation=name_bank_validation,
            description='Rentee bank account'
        )


class Migration(migrations.Migration):

    dependencies = [
    ]

    operations = [
        migrations.RunPython(add_partner_rentee, migrations.RunPython.noop),
    ]
