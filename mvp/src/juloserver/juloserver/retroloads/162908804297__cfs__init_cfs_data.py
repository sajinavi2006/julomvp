# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2021-08-16 04:27
from __future__ import unicode_literals

from django.db import migrations

from juloserver.julo.constants import FeatureNameConst
from juloserver.julo.models import FeatureSetting
from juloserver.cfs.models import CfsAction
from juloserver.otp.constants import SessionTokenAction, SessionTokenType

CFS_FAQS = {
    'header': 'Penjelasan tentang Jscore',
    'topics': [
        {
            'icon': 'https://julostatics.oss-ap-southeast-5.aliyuncs.com/cfs/faq1_icon.png',
            'question': 'Apa itu Jscore',
            'answer': 'Jscore adalah fitur terbaru dari JULO yang bisa memberi tahu kamu '
                      'gambaran tentang seberapa baik kemampuan kreditmu saat ini. Jscore '
                      'kamu berkaitan erat dengan jumlah limit yang kamu terima',
        },
        {
            'icon': 'https://julostatics.oss-ap-southeast-5.aliyuncs.com/cfs/faq2_icon.png',
            'question': 'Apa saja hal yang mempengaruhi Jscore?',
            'answer': 'Pembayaran tepat waktu atau sebelum jatuh tempo, data - data pribadi yang '
                      'berkaitan dengan kemampuan finansial kamu, serta sejarah dan riwayat '
                      'kreditmu menjadi faktor yang mempengaruhi Jscore',
        },
        {
            'icon': 'https://julostatics.oss-ap-southeast-5.aliyuncs.com/cfs/faq3_icon.png',
            'question': 'Bagaimana cara saya menaikkan Jscore?',
            'answer': 'Ikuti terus misi - misi yang ada di JULO ya! Semakin sering kamu mengikuti '
                      'misi tersebut, semakin tinggi pula kenaikan limit kamu. Jscore juga '
                      'akan diperbaharui setiap bulannya agar menunjukkan Jscore yang labih '
                      'akurat'
        }
    ]
}

ACTIONS = [
    {
        'cfs_action_id': 1,
        'action_code': 'referral',
        'title': 'Undang Teman, Dapat Cashback',
        'display_order': 1,
        'is_active': True,
        'icon': 'https://julostatics.oss-ap-southeast-5.aliyuncs.com/cfs/mission_referral_icon.png',
        'app_link': 'deeplink',
        'action_type': 'unlimited',
        'default_expiry': -1,
        'is_need_agent_verify': False,
    },
    {
        'cfs_action_id': 2,
        'action_code': 'connect_bank',
        'title': 'Hubungkan akun Bank Anda',
        'display_order': 2,
        'is_active': True,
        'cashback_amount': 500,
        'icon': 'https://julostatics.oss-ap-southeast-5.aliyuncs.com/cfs/connect_bank_icon.png',
        'first_occurrence_cashback_amount': 5000,
        'repeat_occurrence_cashback_amount': 1000,
        'app_link': 'deeplink',
        'action_type': 'recurring',
        'default_expiry': 90,
        'is_need_agent_verify': True,
        'app_version': '5.14.0',
    },
    {
        'cfs_action_id': 3,
        'action_code': 'connect_bpjs',
        'title': 'Hubungkan akun BPJS Anda',
        'display_order': 3,
        'is_active': False,
        'icon': 'https://julostatics.oss-ap-southeast-5.aliyuncs.com/cfs/bpjs_icon.png',
        'app_link': 'deeplink',
        'first_occurrence_cashback_amount': 4000,
        'repeat_occurrence_cashback_amount': 750,
        'action_type': 'recurring',
        'default_expiry': 90,
        'is_need_agent_verify': True,
        'app_version': '5.14.0',
    },
    {
        'cfs_action_id': 4,
        'action_code': 'upload_utilities_bill',
        'title': 'Upload bukti tagihan kebutuhan',
        'display_order': 4,
        'is_active': True,
        'icon': 'https://julostatics.oss-ap-southeast-5.aliyuncs.com/cfs/upload_utilities_document.png',
        'app_link': 'deeplink',
        'first_occurrence_cashback_amount': 2000,
        'repeat_occurrence_cashback_amount': 500,
        'action_type': 'recurring',
        'default_expiry': 90,
        'is_need_agent_verify': True,
        'app_version': '5.14.0',
    },
    {
        'cfs_action_id': 5,
        'action_code': 'upload_salary_slip',
        'title': 'Upload bukti slip gaji',
        'display_order': 5,
        'is_active': True,
        'icon': 'https://julostatics.oss-ap-southeast-5.aliyuncs.com/cfs/upload_utilities_document.png',
        'app_link': 'deeplink',
        'first_occurrence_cashback_amount': 2000,
        'repeat_occurrence_cashback_amount': 500,
        'action_type': 'recurring',
        'default_expiry': 90,
        'is_need_agent_verify': True,
        'app_version': '5.14.0',
    },
    {
        'cfs_action_id': 6,
        'action_code': 'upload_bank_statement',
        'title': 'Upload bukti mutasi rekening',
        'display_order': 6,
        'is_active': True,
        'icon': 'https://julostatics.oss-ap-southeast-5.aliyuncs.com/cfs/upload_utilities_document.png',
        'app_link': 'deeplink',
        'first_occurrence_cashback_amount': 2000,
        'repeat_occurrence_cashback_amount': 500,
        'action_type': 'recurring',
        'default_expiry': 90,
        'is_need_agent_verify': True,
        'app_version': '5.14.0',
    },
    {
        'cfs_action_id': 7,
        'action_code': 'verify_phone_number_1',
        'title': 'Verifikasi ulang nomor HP Anda',
        'display_order': 7,
        'is_active': True,
        'icon': 'https://julostatics.oss-ap-southeast-5.aliyuncs.com/cfs/verify_phone_icon.png',
        'app_link': 'deeplink',
        'first_occurrence_cashback_amount': 2000,
        'repeat_occurrence_cashback_amount': 500,
        'action_type': 'recurring',
        'default_expiry': 90,
        'is_need_agent_verify': False,
        'app_version': '5.14.0',
    },
    {
        'cfs_action_id': 8,
        'action_code': 'verify_phone_number_2',
        'title': 'Tambah nomor HP Anda lainnya',
        'display_order': 8,
        'is_active': True,
        'icon': 'https://julostatics.oss-ap-southeast-5.aliyuncs.com/cfs/verify_phone_icon.png',
        'app_link': 'deeplink',
        'first_occurrence_cashback_amount': 2000,
        'repeat_occurrence_cashback_amount': 500,
        'action_type': 'recurring',
        'default_expiry': 90,
        'is_need_agent_verify': False,
        'app_version': '5.14.0',
    },
    {
        'cfs_action_id': 10,
        'action_code': 'verify_family_phone_number',
        'title': 'Tambah nomor HP keluarga/kerabat',
        'display_order': 10,
        'is_active': True,
        'icon': 'https://julostatics.oss-ap-southeast-5.aliyuncs.com/cfs/verify_phone_icon.png',
        'app_link': 'deeplink',
        'first_occurrence_cashback_amount': 500,
        'repeat_occurrence_cashback_amount': 100,
        'action_type': 'recurring',
        'default_expiry': 90,
        'is_need_agent_verify': True,
        'app_version': '5.14.0',
    },
    {
        'cfs_action_id': 11,
        'action_code': 'verify_office_phone_number',
        'title': 'Tambah nomor telepon kantor Anda',
        'display_order': 11,
        'is_active': True,
        'icon': 'https://julostatics.oss-ap-southeast-5.aliyuncs.com/cfs/verify_phone_icon.png',
        'app_link': 'deeplink',
        'first_occurrence_cashback_amount': 750,
        'repeat_occurrence_cashback_amount': 250,
        'action_type': 'recurring',
        'default_expiry': 90,
        'is_need_agent_verify': True,
        'app_version': '5.14.0',
    },
    {
        'cfs_action_id': 12,
        'action_code': 'verify_address',
        'title': 'Verifikasi ulang alamat Anda saat ini',
        'display_order': 12,
        'is_active': True,
        'icon': 'https://julostatics.oss-ap-southeast-5.aliyuncs.com/cfs/verify_address_icon.png',
        'app_link': 'deeplink',
        'first_occurrence_cashback_amount': 500,
        'repeat_occurrence_cashback_amount': 100,
        'action_type': 'recurring',
        'default_expiry': 90,
        'is_need_agent_verify': False,
        'app_version': '5.14.0',
    },
    {
        'cfs_action_id': 13,
        'action_code': 'share_to_social_media',
        'title': 'Bagikan ke sosial media Anda',
        'display_order': 13,
        'is_active': True,
        'icon': 'https://julostatics.oss-ap-southeast-5.aliyuncs.com/cfs/verify_phone_icon.png',
        'app_link': 'deeplink',
        'first_occurrence_cashback_amount': 500,
        'repeat_occurrence_cashback_amount': 100,
        'action_type': 'recurring',
        'default_expiry': 30,
        'is_need_agent_verify': False,
        'app_version': '5.14.0',
    }
]


def init_cfs_feature_setting(apps, _schema_editor):
    data_create = {
        'feature_name': FeatureNameConst.CFS,
        'is_active': True,
        'category': 'CFS',
        'parameters': {
            'faqs': CFS_FAQS,
        },
    }
    FeatureSetting.objects.create(**data_create)


def init_cfs_action_data(apps, _schema_editor):
    bulk_create_cfs_action = []
    for action in ACTIONS:
        cfs_action = CfsAction(
                id=action['cfs_action_id'],
                action_code=action['action_code'],
                title=action['title'],
                display_order=action['display_order'],
                is_active=action['is_active'],
                action_type=action['action_type'],
                default_expiry=action['default_expiry'],
                icon=action['icon'],
                app_link=action['app_link'],
                first_occurrence_cashback_amount=action.get('first_occurrence_cashback_amount'),
                repeat_occurrence_cashback_amount=action.get('repeat_occurrence_cashback_amount'),
                is_need_agent_verify=action['is_need_agent_verify'],
            )
        if action.get('app_version'):
            cfs_action.app_version = action['app_version']
        bulk_create_cfs_action.append(cfs_action)

    CfsAction.objects.bulk_create(bulk_create_cfs_action)


def init_otp_feature_setting_for_mission_verify_phone(apps, _schema_editor):
    action_type_setting = FeatureSetting.objects.filter(
        feature_name='otp_action_type').last()
    if action_type_setting:
        parameters = action_type_setting.parameters
        parameters.update({
            SessionTokenAction.VERIFY_PHONE_NUMBER_2: SessionTokenType.SHORT_LIVED,
        })
        action_type_setting.parameters = parameters
        action_type_setting.save()


class Migration(migrations.Migration):

    dependencies = [
    ]

    operations = [
        migrations.RunPython(init_cfs_feature_setting, migrations.RunPython.noop),
        migrations.RunPython(init_cfs_action_data, migrations.RunPython.noop),
        migrations.RunPython(
            init_otp_feature_setting_for_mission_verify_phone, migrations.RunPython.noop
        ),

    ]

