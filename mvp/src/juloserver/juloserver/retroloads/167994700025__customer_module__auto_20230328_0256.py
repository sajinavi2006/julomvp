# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2023-03-27 19:56
from __future__ import unicode_literals

from django.contrib.auth.models import User
from django.db import migrations

from juloserver.customer_module.services.digital_signature import DigitalSignature, \
    CertificateAuthority
from django.conf import settings

def generate_certificate_for_athe(apps, schema_editor):
    athe = User.objects.filter(email='athe.ginting@julo.co.id').last()
    signer = DigitalSignature.Signer(
        user=athe,
        key_name="key-{}-1".format(athe.id),
        for_organization=True,
        organization="PT. JULO Teknologi Finansial",
        full_name="Gharnis Athe M. Ginting",
        email=athe.email,
        province="DKI Jakarta",
        city="Jakarta Selatan",
        address="Eightyeight @ Kasablanka Office Tower, Lantai 10, Unit E. Jl. Casablanca Raya, Kav. 88, Menteng Dalam, Tebet",
    )
    if not signer.key_exists():
        signer.generate_key_pairs()
    if signer.signer.has_certificate():
        return
    signer.signer.generate_csr()
    CertificateAuthority(
        private_key=settings.JULO_CERTIFICATE_AUTHORITY["PRIVATE_KEY"],
        passphrase=settings.JULO_CERTIFICATE_AUTHORITY["PASSPHRASE"],
        certificate=settings.JULO_CERTIFICATE_AUTHORITY["CERTIFICATE"],
    ).make_certificate(signer.signer)


class Migration(migrations.Migration):

    dependencies = [
    ]

    operations = [
        migrations.RunPython(generate_certificate_for_athe, migrations.RunPython.noop),

    ]
