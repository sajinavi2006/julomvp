# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2020-12-31 07:36
from __future__ import unicode_literals

from django.db import migrations
from juloserver.streamlined_communication.constant import CommunicationPlatform, CardProperty
from juloserver.streamlined_communication.models import (
    StreamlinedCommunication, StreamlinedMessage, InfoCardProperty)


def update_stream_line_message(app, schema_editor):
    button_2_properties = {'card_type': '2',
                           'title': 'Mohon maaf' + '\U0001F64F',
                           'title_color': '#ffffff',
                           'text_color': '#ffffff',
                           'card_order_number': 1}
    info_card_property = InfoCardProperty.objects.filter(**button_2_properties).last()
    if not info_card_property:
        info_card_property = InfoCardProperty.objects.create(**button_2_properties)
    data_streamlined_message = {
        'info_card_property': info_card_property,
        'message_content': 'Anda belum sesuai kriteria untuk dapat melakukan pinjaman. '
                           'Namun, Anda masih dapat melakukan pinjaman melalui BFI.'
    }

    message = StreamlinedMessage.objects.filter(**data_streamlined_message).last()
    if not message:
        message = StreamlinedMessage.objects.create(**data_streamlined_message)

    info_cards = list(StreamlinedCommunication.objects.filter(
        communication_platform=CommunicationPlatform.INFO_CARD,
        status_code_id=105,
        extra_conditions=CardProperty.CUSTOMER_HAVE_LOW_SCORE_OR_C,
        is_active=True
    ))
    for info_card in info_cards:
        info_card.update_safely(message=message)


class Migration(migrations.Migration):

    dependencies = [
    ]

    operations = [
        migrations.RunPython(update_stream_line_message, migrations.RunPython.noop)
    ]
