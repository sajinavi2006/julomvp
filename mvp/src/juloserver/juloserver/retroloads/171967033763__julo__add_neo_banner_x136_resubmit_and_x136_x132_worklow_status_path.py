# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2024-06-29 14:12
from __future__ import unicode_literals

from django.db import migrations

from juloserver.streamlined_communication.models import NeoBannerCard
from juloserver.julo.models import WorkflowStatusPath, Workflow
from juloserver.julo.constants import WorkflowConst


def retroload_neobanner_j1(_apps, _schema_editor):
    neo_banner_card = NeoBannerCard.objects.get(statuses='[106_REAPPLY, 136]')
    neo_banner_card.statuses = '[106_REAPPLY, 136_REAPPLY]'
    neo_banner_card.save()

    neo_banner_card = NeoBannerCard.objects.get(statuses='[131]')
    neo_banner_card.statuses = '[131, 136_RESUBMIT]'
    neo_banner_card.save()


def retroload_workflow_status_path(_apps, _schema_editor):
    workflow = Workflow.objects.filter(name=WorkflowConst.JULO_ONE).last()
    if not WorkflowStatusPath.objects.filter(
        workflow=workflow, status_previous=136, status_next=132
    ).exists():
        WorkflowStatusPath.objects.create(
            workflow=workflow, status_previous=136, status_next=132, type="detour"
        )


class Migration(migrations.Migration):

    dependencies = []

    operations = [
        migrations.RunPython(retroload_neobanner_j1, migrations.RunPython.noop),
        migrations.RunPython(retroload_workflow_status_path, migrations.RunPython.noop),
    ]
