# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2025-01-23 09:10
from __future__ import unicode_literals

from django.db import migrations
from juloserver.streamlined_communication.models import (
    StreamlinedCommunication,
    InfoCardProperty,
)
from juloserver.streamlined_communication.constant import CommunicationPlatform
from juloserver.julo.constants import FeatureNameConst


def change_url_destination(apps, _schema_editor):
    info_card_property_ids = list(
        StreamlinedCommunication.objects.filter(
            communication_platform=CommunicationPlatform.INFO_CARD,
            extra_conditions=FeatureNameConst.MARKETING_LOAN_PRIZE_CHANCE,
        ).values_list('message__info_card_property_id', flat=True)
    )
    InfoCardProperty.objects.filter(pk__in=info_card_property_ids).update(
        card_destination='https://julo.co.id/tiket-borongshai-1?in_app=true&chances={{prize_chances}}'
    )


class Migration(migrations.Migration):
    dependencies = []

    operations = [migrations.RunPython(change_url_destination)]
