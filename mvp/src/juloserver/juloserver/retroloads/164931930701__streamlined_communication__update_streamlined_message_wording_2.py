# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2022-04-05 04:41
from __future__ import unicode_literals

from django.db import migrations
from juloserver.streamlined_communication.models import (InfoCardProperty,
                                                         StreamlinedMessage,
                                                         StreamlinedCommunication)
smile_emoji = '\U0001F642'
praying_emoji = '\U0001F64F'


def update_wording(_apps, _schema_editor):
    updated_data = [
        {
            'title': 'Mohon maaf' + praying_emoji,
            'filter': {
            	'extra_conditions': 'CUSTOMER_HAVE_LOW_SCORE_OR_C'
            },
            'content': 'Kamu belum sesuai kriteria untuk dapat melakukan pinjaman. '
                       'Namun, kamu masih dapat melakukan pinjaman melalui BFI.'
        },
        {
            'title': 'Mohon menunggu' + smile_emoji,
            'filter': {},
            'content': 'Tim kami akan segera menghubungi untuk proses verifikasi. '
                       'Pastikan telepon kamu aktif saat dihubungi.'
        }
    ]

    for data in updated_data:
    	info_card_ids = InfoCardProperty.objects.filter(
    						title=data['title']).values_list(
    						'pk',flat=True)
    	message_ids = StreamlinedCommunication.objects.filter(
    					**data['filter'],
    					is_active=True
    				  ).values_list('message_id', flat=True)
    	streamlined_messages = StreamlinedMessage.objects.filter(
    							info_card_property_id__in=info_card_ids,
    							pk__in=message_ids
							   ).update(message_content=data['content'])


class Migration(migrations.Migration):

    dependencies = [
    ]

    operations = [
        migrations.RunPython(update_wording, migrations.RunPython.noop)
    ]
