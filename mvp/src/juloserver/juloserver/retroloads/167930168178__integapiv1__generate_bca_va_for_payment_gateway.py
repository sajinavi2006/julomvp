# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2023-03-20 08:41
from __future__ import unicode_literals

from django.db import migrations

from juloserver.integapiv1.models import (
    EscrowPaymentGateway,
    EscrowPaymentMethodLookup,
    EscrowPaymentMethod,
)


def generate_bca_va_for_payment_gateway(apps, schema_editor):
    DATA_PAYMENT_GATEWAY = [
        {
            'owner': 'Faspay',
            'description': 'Faspay - PT JULO Teknologi Finansial'
        },
        {
            'owner': 'Midtrans',
            'description': 'Midtrans - PT JULO Teknologi Finansial'
        },
        {
            'owner': 'Xendit',
            'description': 'Xendit - PT JULO Teknologi Finansial'
        },
        {
            'owner': 'Dana',
            'description': 'Dana - PT JULO Teknologi Finansial'
        },
        {
            'owner': 'EFishery',
            'description': 'EFishery - PT JULO Teknologi Finansial'
        },
        {
            'owner': 'Koperasi Tunas',
            'description': 'Koperasi Tunas - PT JULO Teknologi Finansial'
        },
        {
            'owner': 'Grab Taxi Indonesia',
            'description': 'Grab Taxi Indonesia - PT JULO Teknologi Finansial'
        },
        {
            'owner': 'Julo Teknologi Perdana',
            'description': 'PT JULO Teknologi Perdana'
        },
        {
            'owner': 'Julo Teknologi Finansial',
            'description': 'PT JULO Teknologi Finansial'
        },
    ]
    escrow_payment_method_lookup, _ = EscrowPaymentMethodLookup.objects.get_or_create(
        payment_method_code='10994',
        payment_method_name='BCA'
    )
    for payment_gateway in DATA_PAYMENT_GATEWAY:
        escrow_payment_gateway, _ = EscrowPaymentGateway.objects.get_or_create(
            owner=payment_gateway['owner'],
            description=payment_gateway['description']
        )
        from django.conf import settings
        suffix = '{}{}'.format(escrow_payment_method_lookup.id, escrow_payment_gateway.id)
        virtual_account = '{}{}'.format(settings.PREFIX_BCA, suffix.zfill(11))
        EscrowPaymentMethod.objects.get_or_create(
            escrow_payment_gateway=escrow_payment_gateway,
            escrow_payment_method_lookup=escrow_payment_method_lookup,
            virtual_account=virtual_account
        )


class Migration(migrations.Migration):

    dependencies = [
    ]

    operations = [
        migrations.RunPython(generate_bca_va_for_payment_gateway, migrations.RunPython.noop)
    ]
