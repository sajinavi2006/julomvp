# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2021-07-09 08:31
from __future__ import unicode_literals

from django.db import migrations

from juloserver.cootek.models import CootekRobot, CootekConfiguration
from juloserver.julo.constants import ExperimentConst
from juloserver.julo.models import ExperimentSetting


def change_cootek_late_dpd_j1_experiment_setting(apps, schema_editor):
    old_experiment = ExperimentSetting.objects.get_or_none(code=ExperimentConst.COOTEK_LATE_DPD_J1)
    old_experiment.schedule = "17:50"
    old_experiment.is_permanent = True
    old_experiment.name = "Cootek Unconnected Late DPD J1"
    old_experiment.criteria = {'calling_hours_until': 2}
    old_experiment.save()
    # setup cootek configuration
    cootek_configs = [
        # dpd 1 - 4
        {
            'strategy_name': 'EXPERIMENT_DPD_LATE_1_4',
            'new_strategy_name': 'unconnected_late_dpd_1-4',
            'time_to_start': '18:00:00',
            'task_type': 'unconnected_late_dpd_1-4',
            'robot_identifier': '93d182db770b381152f5fa5ccd2a519a',
            'new_robot_name': "robot_unconnected_late_dpd_1-4",
        },
        # dpd 5 - 40
        {
            'strategy_name': 'EXPERIMENT_DPD_LATE_5_40',
            'new_strategy_name': 'unconnected_late_dpd_5-40',
            'time_to_start': '18:00:00',
            'task_type': 'unconnected_late_dpd_5-40',
            'robot_identifier': '92ee3c2eebbe6c4d3bc3d9110bd448b6',
            'new_robot_name': "robot_unconnected_late_dpd_5-40",
        },
    ]

    for config in cootek_configs:
        robot = CootekRobot.objects.filter(
            robot_identifier=config['robot_identifier']).first()
        robot.robot_name = config['new_robot_name']
        robot.save()

        old_cootek_configuration = CootekConfiguration.objects.filter(
            strategy_name=config['strategy_name']
        ).last()
        old_cootek_configuration.strategy_name = config['new_strategy_name']
        old_cootek_configuration.time_to_start = config['time_to_start']
        old_cootek_configuration.task_type = config['task_type']
        old_cootek_configuration.save()


class Migration(migrations.Migration):
    dependencies = [
    ]

    operations = [
        migrations.RunPython(change_cootek_late_dpd_j1_experiment_setting, migrations.RunPython.noop)
    ]
