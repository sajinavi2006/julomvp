# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2020-09-30 08:56
from __future__ import unicode_literals

from builtins import str
from builtins import object
from django.db import migrations
from juloserver.julo.statuses import ApplicationStatusCodes
from juloserver.julo.utils import upload_file_to_oss
from juloserver.streamlined_communication.models import (InfoCardButtonProperty,
                                                         CardProperty,
                                                         InfoCardProperty,
                                                         StreamlinedMessage,
                                                         StreamlinedCommunication)
from juloserver.streamlined_communication.constant import CommunicationPlatform
from juloserver.julo.models import StatusLookup, Image
from juloserver.streamlined_communication.services import create_and_upload_image_assets_for_streamlined
from django.conf import settings
praying_emoji = '\U0001F64F'
party_popper_emoji = '\U0001F389'
hourglass_emoji = '\U000023F3'
warning_emoji = '\U000026A0'
smile_emoji = '\U0001F642'
L_BUTTON = 'L.BUTTON'
R_BUTTON = 'R.BUTTON'
M_BUTTON = 'M.BUTTON'


class ImageNames(object):
    DESIGNS_REAL = 'info-card/designs_real.png'
    GROUP_3500 = 'info-card/group_3500.png'
    LAYER_3 = 'info-card/layer_3.png'
    LAYER_4 = 'info-card/layer_4.png'
    LAYER_5 = 'info-card/layer_5.png'
    LAYER_6 = 'info-card/layer_6.png'
    RECTANGLE_1489 = 'info-card/rectangle_1489.png'
    RECTANGLE_1489_2 = 'info-card/rectangle_1489_2.png'


def create_image(image_source_id, image_type, image_url):
    image = Image()
    image.image_source = image_source_id
    image.image_type = image_type
    image.url = image_url
    image.save()


def retroload_cards_data_julo_one(_apps, _schema_editor):
    data_to_be_loaded = [
        {
            'status': ApplicationStatusCodes.FORM_PARTIAL,
            'additional_condition': 'CUSTOMER_HAVE_HIGH_SCORE',
            'title': 'Proses Verifikasi telepon 📞',
            'content': 'Anda akan segera dihubungi untuk proses verifikasi. '
                       'Pastikan telepon Anda aktif saat dihubungi. ',
            'button': [],
            'click_to': [],
            'template_type': '2',
            'card_number': 1,
            'text_colour': '#ffffff',
            'title_colour': '#ffffff',
            'background_url': ImageNames.DESIGNS_REAL,
            'additional_images': [],
            'button_url': []
        },
        {
            'status': ApplicationStatusCodes.FORM_PARTIAL,
            'additional_condition': 'CUSTOMER_HAVE_MEDIUM_SCORE',
            'title': 'Selamat! Tinggal sedikit lagi' + party_popper_emoji,
            'content': 'Mohon lengkapi dokumen yang dibutuhkan '
                       'untuk dapat melanjutkan proses pengajuan.',
            'button': ['Lengkapi Dokumen'],
            'button_name': [R_BUTTON],
            'click_to': ['appl_docs'],
            'template_type': '1',
            'card_number': 2,
            'text_colour': '#ffffff',
            'title_colour': '#ffffff',
            'background_url': ImageNames.LAYER_4,
            'additional_images': [ImageNames.LAYER_6],
            'button_url': [ImageNames.RECTANGLE_1489]
        },
        {
            'status': ApplicationStatusCodes.FORM_PARTIAL,
            'additional_condition': 'CUSTOMER_HAVE_HIGH_C_SCORE',
            'title': 'Selamat! Tinggal sedikit lagi' + party_popper_emoji,
            'content': 'Mohon lengkapi dokumen yang dibutuhkan untuk dapat melanjutkan '
                       'proses pengajuan.',
            'button': ['Lengkapi Dokumen'],
            'button_name': [R_BUTTON],
            'click_to': ['appl_docs'],
            'template_type': '1',
            'card_number': 3,
            'text_colour': '#ffffff',
            'title_colour': '#ffffff',
            'background_url': ImageNames.LAYER_4,
            'additional_images': [ImageNames.LAYER_6],
            'button_url': [ImageNames.RECTANGLE_1489]
        },
        {
            'status': ApplicationStatusCodes.FORM_PARTIAL,
            'additional_condition': 'CUSTOMER_HAVE_LOW_SCORE_OR_C',
            'title': 'Mohon maaf' + praying_emoji,
            'content': 'Anda belum sesuai kriteria untuk dapat melakukan pinjaman. '
                       'Namun, Anda masih dapat melakukan pinjaman melalui BFI '
                       'atau Kreditpedia.',
            'button': [],
            'click_to': [],
            'template_type': '2',
            'card_number': 1,
            'text_colour': '#ffffff',
            'title_colour': '#ffffff',
            'background_url': ImageNames.DESIGNS_REAL,
            'additional_images': [],
            'button_url': []
        },
        {
            'status': ApplicationStatusCodes.FORM_PARTIAL_EXPIRED,
            'additional_condition': 'ALL_106_EXPECT_PREVIOUS_EXPIRY_REASON',
            'title': 'Form Anda telah kadaluarsa',
            'content': 'Silahkan lakukan pengisian form kembali untuk '
                       'melanjutkan proses pengajuan.',
            'button': ['Isi Form Kembali'],
            'button_name': [M_BUTTON],
            'click_to': ['reapply_j1'],
            'template_type': '2',
            'card_number': 1,
            'text_colour': '#ffffff',
            'title_colour': '#ffffff',
            'background_url': ImageNames.DESIGNS_REAL,
            'additional_images': [],
            'button_url': [ImageNames.RECTANGLE_1489]
        },
        {
            'status': ApplicationStatusCodes.FORM_PARTIAL_EXPIRED,
            'additional_condition': 'MOVE_TO_106_WITH_REASON_NEGATIVE_PAYMENT_HISTORY',
            'title': 'Mohon maaf' + praying_emoji,
            'content': 'Anda belum sesuai kriteria untuk dapat melakukan pinjaman. Namun, '
                       'Anda masih dapat melakukan pinjaman melalui BFI atau Kreditpedia.',
            'button': [],
            'click_to': [],
            'template_type': '2',
            'card_number': 2,
            'text_colour': '#ffffff',
            'title_colour': '#ffffff',
            'background_url': ImageNames.DESIGNS_REAL,
            'additional_images': [],
            'button_url': []
        },
        {
            'status': ApplicationStatusCodes.DOCUMENTS_SUBMITTED,
            'additional_condition': None,
            'title': 'Dalam proses verifikasi ' + hourglass_emoji,
            'content': 'Data pengajuan Anda telah diterima dan sedang diverifikasi. '
                       'Silahkan kembali dalam satu hari kerja untuk memeriksa '
                       'status pengajuan Anda.',
            'button': [],
            'click_to': [],
            'template_type': '2',
            'card_number': 1,
            'text_colour': '#ffffff',
            'title_colour': '#ffffff',
            'background_url': ImageNames.DESIGNS_REAL,
            'additional_images': [],
            'button_url': []
        },
        {
            'status': ApplicationStatusCodes.SCRAPED_DATA_VERIFIED,
            'additional_condition': None,
            'title': 'Dalam proses verifikasi ' + hourglass_emoji,
            'content': 'Data pengajuan Anda telah diterima dan sedang diverifikasi. '
                       'Silahkan kembali dalam satu hari kerja untuk memeriksa '
                       'status pengajuan Anda.',
            'button': [],
            'click_to': [],
            'template_type': '2',
            'card_number': 1,
            'text_colour': '#ffffff',
            'title_colour': '#ffffff',
            'background_url': ImageNames.DESIGNS_REAL,
            'additional_images': [],
            'button_url': []
        },
        {
            'status': ApplicationStatusCodes.DOCUMENTS_VERIFIED,
            'additional_condition': None,
            'title': 'Dalam proses verifikasi ' + hourglass_emoji,
            'content': 'Data pengajuan Anda telah diterima dan sedang diverifikasi. '
                       'Silahkan kembali dalam satu hari kerja untuk memeriksa '
                       'status pengajuan Anda.',
            'button': [],
            'click_to': [],
            'template_type': '2',
            'card_number': 1,
            'text_colour': '#ffffff',
            'title_colour': '#ffffff',
            'background_url': ImageNames.DESIGNS_REAL,
            'additional_images': [],
            'button_url': []
        },
        {
            'status': ApplicationStatusCodes.VERIFICATION_CALLS_SUCCESSFUL,
            'additional_condition': None,
            'title': 'Proses Verifikasi telepon 📞',
            'content': 'Anda akan segera dihubungi untuk proses verifikasi. '
                       'Pastikan telepon Anda aktif saat dihubungi.',
            'button': [],
            'click_to': [],
            'template_type': '2',
            'card_number': 1,
            'text_colour': '#ffffff',
            'title_colour': '#ffffff',
            'background_url': ImageNames.DESIGNS_REAL,
            'additional_images': [],
            'button_url': []
        },
        {
            'status': ApplicationStatusCodes.CALL_ASSESSMENT,
            'additional_condition': None,
            'title': 'Dalam proses verifikasi ' + hourglass_emoji,
            'content': 'Data pengajuan Anda telah diterima dan sedang diverifikasi. '
                       'Silahkan kembali dalam satu hari kerja untuk memeriksa status '
                       'pengajuan Anda.',
            'button': [],
            'click_to': [],
            'template_type': '2',
            'card_number': 1,
            'text_colour': '#ffffff',
            'title_colour': '#ffffff',
            'background_url': ImageNames.DESIGNS_REAL,
            'additional_images': [],
            'button_url': []
        },
        {
            'status': ApplicationStatusCodes.PENDING_PARTNER_APPROVAL,
            'additional_condition': None,
            'title': 'Pengajuan Anda telah diterima',
            'content': 'Data pengajuan pinjaman Anda telah diterima dan sedang '
                       'diverifikasi oleh BFI. Silahkan hubungi Customer Service '
                       'BFI di 1500018 untuk informasi lebih lanjut.',
            'button': [],
            'click_to': [],
            'template_type': '2',
            'card_number': 1,
            'text_colour': '#ffffff',
            'title_colour': '#ffffff',
            'background_url': ImageNames.DESIGNS_REAL,
            'additional_images': [],
            'button_url': []
        },
        {
            'status': ApplicationStatusCodes.APPLICANT_CALLS_SUCCESSFUL,
            'additional_condition': None,
            'title': 'Proses Verifikasi telepon 📞',
            'content': 'Anda akan segera dihubungi untuk proses verifikasi. '
                       'Pastikan telepon Anda aktif saat dihubungi.',
            'button': [],
            'click_to': [],
            'template_type': '2',
            'card_number': 1,
            'text_colour': '#ffffff',
            'title_colour': '#ffffff',
            'background_url': ImageNames.DESIGNS_REAL,
            'additional_images': [],
            'button_url': []
        },
        {
            'status': ApplicationStatusCodes.APPLICATION_RESUBMISSION_REQUESTED,
            'additional_condition': None,
            'title': warning_emoji + '️Data Anda belum lengkap ' + warning_emoji,
            'content': 'Silahkan kembali ke proses pengajuan dengan '
                       'mengunggah foto-foto dokumen yang masih kurang.',
            'button': ['Unggah Dokumen'],
            'button_name': [M_BUTTON],
            'click_to': ['j1_appl_docs'],
            'template_type': '2',
            'card_number': 1,
            'text_colour': '#ffffff',
            'title_colour': '#ffffff',
            'background_url': ImageNames.DESIGNS_REAL,
            'additional_images': [],
            'button_url': [ImageNames.RECTANGLE_1489]
        },
        {
            'status': ApplicationStatusCodes.APPLICATION_RESUBMITTED,
            'additional_condition': None,
            'title': 'Dalam proses verifikasi ' + hourglass_emoji,
            'content': 'Data pengajuan Anda telah diterima dan sedang diverifikasi. '
                       'Silahkan kembali dalam satu hari kerja untuk memeriksa '
                       'status pengajuan Anda.',
            'button': [],
            'click_to': [],
            'template_type': '2',
            'card_number': 1,
            'text_colour': '#ffffff',
            'title_colour': '#ffffff',
            'background_url': ImageNames.DESIGNS_REAL,
            'additional_images': [],
            'button_url': []
        },
        {
            'status': ApplicationStatusCodes.APPLICATION_FLAGGED_FOR_FRAUD,
            'additional_condition': None,
            'title': 'Mohon maaf' + praying_emoji,
            'content': 'Berdasarkan analisa oleh pihak JULO, permohonan Anda belum '
                       'dapat disetujui untuk saat ini karena belum memenuhi '
                       'kriteria yang ada.',
            'button': [],
            'click_to': [],
            'template_type': '2',
            'card_number': 1,
            'text_colour': '#ffffff',
            'title_colour': '#ffffff',
            'background_url': ImageNames.DESIGNS_REAL,
            'additional_images': [],
            'button_url': []
        },
        {
            'status': ApplicationStatusCodes.APPLICATION_FLAGGED_FOR_SUPERVISOR,
            'additional_condition': None,
            'title': 'Dalam proses verifikasi ' + hourglass_emoji,
            'content': 'Data pengajuan Anda telah diterima dan sedang diverifikasi. '
                       'Silahkan kembali dalam satu hari kerja untuk memeriksa '
                       'status pengajuan Anda.',
            'button': [],
            'click_to': [],
            'template_type': '2',
            'card_number': 1,
            'text_colour': '#ffffff',
            'title_colour': '#ffffff',
            'background_url': ImageNames.DESIGNS_REAL,
            'additional_images': [],
            'button_url': []
        },
        {
            'status': ApplicationStatusCodes.APPLICATION_DENIED,
            'additional_condition': None,
            'title': 'Mohon maaf' + praying_emoji,
            'content': 'Berdasarkan analisa oleh pihak JULO, permohonan Anda belum dapat '
                       'disetujui untuk saat ini karena belum memenuhi kriteria yang ada.',
            'button': [],
            'click_to': [],
            'template_type': '2',
            'card_number': 1,
            'text_colour': '#ffffff',
            'title_colour': '#ffffff',
            'background_url': ImageNames.DESIGNS_REAL,
            'additional_images': [],
            'button_url': []
        },
        {
            'status': ApplicationStatusCodes.APPLICATION_DENIED,
            'additional_condition': 'ALREADY_ELIGIBLE_TO_REAPPLY',
            'title': 'Ajukan pinjaman JULO lagi! ' + party_popper_emoji,
            'content': 'Silahkan isi & lengkapi form untuk melanjutkan proses pengajuan Anda. ',
            'button': ['Lengkapi Form'],
            'button_name': [R_BUTTON],
            'click_to': ['reapply_j1'],
            'template_type': '1',
            'card_number': 2,
            'text_colour': '#ffffff',
            'title_colour': '#ffffff',
            'background_url': ImageNames.LAYER_4,
            'additional_images': [ImageNames.LAYER_3],
            'button_url': [ImageNames.RECTANGLE_1489]
        },
        {
            'status': ApplicationStatusCodes.RESUBMISSION_REQUEST_ABANDONED,
            'additional_condition': None,
            'title': 'Permintaan telah kadaluarsa',
            'content': 'Silahkan lakukan pengisian form kembali untuk melanjutkan proses pengajuan.',
            'button': ['Isi Form Kembali'],
            'button_name': [M_BUTTON],
            'click_to': ['appl_main'],
            'template_type': '2',
            'card_number': 1,
            'text_colour': '#ffffff',
            'title_colour': '#ffffff',
            'background_url': ImageNames.DESIGNS_REAL,
            'additional_images': [],
            'button_url': [ImageNames.RECTANGLE_1489]
        },
        {
            'status': ApplicationStatusCodes.VERIFICATION_CALLS_EXPIRED,
            'additional_condition': None,
            'title': 'Permintaan telah kadaluarsa',
            'content': 'Silahkan lakukan pengisian form kembali untuk '
                       'melanjutkan proses pengajuan.',
            'button_name': [M_BUTTON],
            'button': ['Isi Form Kembali'],
            'click_to': ['appl_main'],
            'template_type': '2',
            'card_number': 1,
            'text_colour': '#ffffff',
            'title_colour': '#ffffff',
            'background_url': ImageNames.DESIGNS_REAL,
            'additional_images': [],
            'button_url': [ImageNames.RECTANGLE_1489]
        },
        {
            'status': ApplicationStatusCodes.OFFER_ACCEPTED_BY_CUSTOMER,
            'additional_condition': None,
            'title': 'Mohon menunggu' + smile_emoji,
            'content': 'Anda akan segera dihubungi untuk proses verifikasi. '
                       'Pastikan telepon Anda aktif saat dihubungi.',
            'button': [],
            'click_to': [],
            'template_type': '2',
            'card_number': 1,
            'text_colour': '#ffffff',
            'title_colour': '#ffffff',
            'background_url': ImageNames.DESIGNS_REAL,
            'additional_images': [],
            'button_url': []
        },
        {
            'status': ApplicationStatusCodes.OFFER_DECLINED_BY_CUSTOMER,
            'additional_condition': None,
            'title': 'Mohon menunggu' + smile_emoji,
            'content': 'Anda akan segera dihubungi untuk proses verifikasi. '
                       'Pastikan telepon Anda aktif saat dihubungi.',
            'button': [],
            'click_to': [],
            'template_type': '2',
            'card_number': 2,
            'text_colour': '#ffffff',
            'title_colour': '#ffffff',
            'background_url': ImageNames.DESIGNS_REAL,
            'additional_images': [],
            'button_url': []
        },
        {
            'status': ApplicationStatusCodes.DIGISIGN_FAILED,
            'additional_condition': None,
            'title': 'Mohon maaf' + praying_emoji,
            'content': 'Proses pendaftaran tanda tangan digital Anda telah gagal. '
                       'Anda dapat menghubungi customer service JULO. ',
            'button': [],
            'click_to': [],
            'template_type': '2',
            'card_number': 1,
            'text_colour': '#ffffff',
            'title_colour': '#ffffff',
            'background_url': ImageNames.DESIGNS_REAL,
            'additional_images': [],
            'button_url': []
        },
        {
            'status': ApplicationStatusCodes.DIGISIGN_FACE_FAILED,
            'additional_condition': None,
            'title': 'Lanjutkan pengajuan Anda',
            'content': 'Segera lengkapi & upload ulang dokumen '
                       'yang diperlukan.',
            'button_name': [M_BUTTON],
            'button': ['Unggah Dokumen'],
            'click_to': ['appl_docs'],
            'template_type': '2',
            'card_number': 1,
            'text_colour': '#ffffff',
            'title_colour': '#ffffff',
            'background_url': ImageNames.DESIGNS_REAL,
            'additional_images': [],
            'button_url': [ImageNames.RECTANGLE_1489]
        },
        {
            'status': ApplicationStatusCodes.ACTIVATION_CALL_SUCCESS_AND_BANK_VALIDATE_ONGOING,
            'additional_condition': None,
            'title': 'Selamat! Tinggal sedikit lagi' + party_popper_emoji,
            'content': 'Silahkan menunggu, informasi terkait limit pinjaman Anda sedang disiapkan. ',
            'button': [],
            'click_to': [],
            'template_type': '1',
            'card_number': 1,
            'text_colour': '#ffffff',
            'title_colour': '#ffffff',
            'background_url': ImageNames.LAYER_4,
            'additional_images': [ImageNames.LAYER_6],
            'button_url': []
        },
        {
            'status': ApplicationStatusCodes.LOC_APPROVED,
            'additional_condition': 'MSG_TO_STAY_UNTIL_1ST_TRANSACTION',
            'title': 'Horeee! Akun JULO mu sudah aktif ' + party_popper_emoji,
            'content': 'Yuk, lakukan transaksi pertamamu sekarang!',
            'button': [],
            'click_to': [],
            'template_type': '1',
            'card_number': 1,
            'text_colour': '#ffffff',
            'title_colour': '#ffffff',
            'background_url': ImageNames.LAYER_4,
            'additional_images': [ImageNames.LAYER_5],
            'button_url': []
        },
    ]
    for data in data_to_be_loaded:
        button_1_properties = {'card_type': '1',
                               'title': data['title'],
                               'title_color': data['title_colour'],
                               'text_color': data['text_colour'],
                               'card_order_number': data['card_number']}
        button_2_properties = {'card_type': '2',
                               'title': data['title'],
                               'title_color': data['title_colour'],
                               'text_color': data['text_colour'],
                               'card_order_number': data['card_number']}
        button_3a_properties = {'card_type': '3a',
                                'card_destination': data['click_to'],
                                'title': data['title'],
                                'title_color': data['title_colour'],
                                'text_color': data['text_colour'],
                                'card_order_number': data['card_number']}
        button_3b_properties = {'card_type': '3b',
                                'title': data['title'],
                                'title_color': data['title_colour'],
                                'text_color': data['text_colour'],
                                'card_order_number': data['card_number']}
        if data['template_type'] == '1':
            info_card = InfoCardProperty.objects.create(**button_1_properties)
        elif data['template_type'] == '2':
            info_card = InfoCardProperty.objects.create(**button_2_properties)
        elif data['template_type'] == '3':
            info_card = InfoCardProperty.objects.create(**button_3b_properties)
        button_info_card = dict()
        if data['button']:
            for idx, image_url in enumerate(data['button']):
                button_info_card['info_card_property'] = info_card
                button_info_card['text'] = data['button'][idx]
                button_info_card['button_name'] = data['button_name'][idx]
                button_info_card['action_type'] = CardProperty.APP_DEEPLINK
                button_info_card['destination'] = data['click_to'][idx]
                button_info_card['text_color'] = data['text_colour']
                button, _ = InfoCardButtonProperty.objects.get_or_create(**button_info_card)
                create_image(button.id, CardProperty.IMAGE_TYPE.button_background_image, data['button_url'][idx])


        data_streamlined_message = {'message_content': data['content'],
                                    'info_card_property': info_card}
        message = StreamlinedMessage.objects.create(**data_streamlined_message)
        status = StatusLookup.objects.filter(status_code=data['status']).last()
        data_for_streamlined_comms = {'status_code': status,
                                      'status': data['status'],
                                      'communication_platform': CommunicationPlatform.INFO_CARD,
                                      'message': message,
                                      'description': 'retroloaded_card_information',
                                      'is_active': True,
                                      'extra_conditions': data['additional_condition']}
        streamlined_communication = StreamlinedCommunication.objects.create(**data_for_streamlined_comms)
        # create image for background
        if data['background_url']:
            create_image(info_card.id, CardProperty.IMAGE_TYPE.card_background_image, data['background_url'])

        if data['additional_images']:
            additional_image_url = data['additional_images']
            additional_image_url = additional_image_url[0]
            create_image(info_card.id, CardProperty.IMAGE_TYPE.card_optional_image, str(additional_image_url))

    # upload image
    images_list = (
        'designs_real.png', 'group_3500.png', 'layer_3.png', 'layer_4.png',
        'layer_5.png', 'layer_6.png', 'rectangle_1489.png', 'rectangle_1489_2.png'
    )
    for image_name in images_list:
        remote_path = 'info-card/{}'.format(image_name)
        upload_file_to_oss(
            settings.OSS_PUBLIC_ASSETS_BUCKET,
            settings.STATICFILES_DIRS[0] + '/images/info_card/{}'.format(image_name),
            remote_path
        )

class Migration(migrations.Migration):

    dependencies = [
    ]

    operations = [
        migrations.RunPython(retroload_cards_data_julo_one, migrations.RunPython.noop)
    ]
