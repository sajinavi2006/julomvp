# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2022-05-25 03:46
from __future__ import unicode_literals
from symbol import parameters

from django.db import migrations
from juloserver.julo.models import FeatureSetting, StatusLookup
from juloserver.julo.constants import FeatureNameConst
from juloserver.payment_point.models import TransactionMethod


def add_new_thresholds_to_bonza_and_new_account_status(apps, schema_editor):
    bonza_feature = FeatureSetting.objects.filter(
        feature_name=FeatureNameConst.BONZA_LOAN_SCORING).last()
    transaction_method_ids = TransactionMethod.objects.filter(
        method__in=['self', 'other']).values_list('id', flat=True)
    parameters = {
        'bonza_scoring_threshold_soft_reject': 33,
        'bonza_scoring_threshold_hard_reject': 50,
        'allowed_transaction_method_ids': list(transaction_method_ids)}
    bonza_feature.parameters = parameters
    bonza_feature.save()
    status_code, status = (443, 'Fraud Soft Reject')
    StatusLookup.objects.create(status_code=status_code, status=status)


class Migration(migrations.Migration):

    dependencies = [
    ]

    operations = [
        migrations.RunPython(add_new_thresholds_to_bonza_and_new_account_status)
    ]
